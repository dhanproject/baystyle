<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>In Memory of Bayu</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --accent: #4361ee;
  --accent2: #7c3aed;
  --accent-light: #eef2ff;
  --green: #22c55e;
  --orange: #f97316;
  --pink: #ec4899;
  --teal: #14b8a6;
  --yellow: #eab308;
  --white: #ffffff;
  --bg: #f4f6fb;
  --card: #ffffff;
  --text: #1a1d2e;
  --text2: #6b7280;
  --text3: #9ca3af;
  --border: #e5e7eb;
  --radius: 20px;
  --radius-sm: 12px;
  --shadow: 0 2px 16px rgba(67,97,238,0.07), 0 1px 4px rgba(0,0,0,0.05);
  --shadow-md: 0 8px 32px rgba(67,97,238,0.12), 0 2px 8px rgba(0,0,0,0.06);
  --shadow-lg: 0 20px 60px rgba(67,97,238,0.18), 0 8px 20px rgba(0,0,0,0.08);
}

[data-theme="dark"] {
  --accent: #6d83f2;
  --accent-light: #1e2240;
  --white: #1a1d2e;
  --bg: #111422;
  --card: #1c1f33;
  --text: #f1f5f9;
  --text2: #94a3b8;
  --text3: #64748b;
  --border: #2a2d45;
  --shadow: 0 2px 16px rgba(0,0,0,0.3);
  --shadow-md: 0 8px 32px rgba(0,0,0,0.4);
  --shadow-lg: 0 20px 60px rgba(0,0,0,0.5);
}

html { scroll-behavior: smooth; }
body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
  transition: background 0.3s, color 0.3s;
}

/* ‚îÄ‚îÄ MOBILE WRAPPER ‚îÄ‚îÄ */
.app-shell {
  max-width: 430px;
  margin: 0 auto;
  min-height: 100vh;
  background: var(--bg);
  position: relative;
  display: flex;
  flex-direction: column;
}

/* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
.topbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 52px 24px 16px;
  background: var(--bg);
  position: sticky;
  top: 0;
  z-index: 50;
}
.topbar-left { display: flex; align-items: center; gap: 12px; }
.avatar {
  width: 42px; height: 42px; border-radius: 50%;
  background: linear-gradient(135deg, var(--accent), var(--pink));
  display: flex; align-items: center; justify-content: center;
  font-size: 1.2rem; font-weight: 700; color: white;
  box-shadow: 0 2px 10px rgba(67,97,238,0.3);
  flex-shrink: 0; overflow: hidden; cursor: pointer;
  position: relative;
}
.avatar img { width: 100%; height: 100%; object-fit: cover; }
.topbar-greeting h1 {
  font-family: 'DM Serif Display', serif;
  font-size: 1.35rem; font-weight: 400; color: var(--text);
  line-height: 1.2;
}
.topbar-greeting p { font-size: 0.78rem; color: var(--text2); margin-top: 1px; }
.topbar-actions { display: flex; align-items: center; gap: 8px; }
.icon-btn {
  width: 36px; height: 36px; border-radius: 50%;
  background: var(--card);
  border: 1.5px solid var(--border);
  color: var(--text);
  display: flex; align-items: center; justify-content: center;
  font-size: 1rem; cursor: pointer;
  transition: all 0.2s;
  box-shadow: var(--shadow);
}
.icon-btn:hover { background: var(--accent); color: white; border-color: var(--accent); transform: scale(1.05); }
.icon-btn.primary {
  background: var(--accent); color: white; border-color: var(--accent);
  box-shadow: 0 4px 14px rgba(67,97,238,0.35);
}
.icon-btn.primary:hover { background: var(--accent2); border-color: var(--accent2); }

/* ‚îÄ‚îÄ STATS BAR ‚îÄ‚îÄ */
.stats-bar {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  padding: 0 24px 20px;
}
.stat-card {
  background: var(--card);
  border-radius: var(--radius-sm);
  padding: 14px 12px;
  box-shadow: var(--shadow);
  text-align: center;
  border: 1px solid var(--border);
  transition: all 0.2s;
}
.stat-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
.stat-icon { font-size: 1.2rem; margin-bottom: 4px; }
.stat-num { font-size: 1.1rem; font-weight: 700; color: var(--text); line-height: 1; }
.stat-label { font-size: 0.62rem; color: var(--text2); margin-top: 2px; font-weight: 500; text-transform: uppercase; letter-spacing: 0.04em; }

/* ‚îÄ‚îÄ SECTION HEADER ‚îÄ‚îÄ */
.section-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 24px 12px;
}
.section-title { font-size: 1rem; font-weight: 700; color: var(--text); }
.section-link {
  font-size: 0.72rem; font-weight: 600;
  color: var(--accent); cursor: pointer;
  background: var(--accent-light);
  padding: 4px 12px; border-radius: 100px;
  border: none; transition: all 0.2s;
}
.section-link:hover { background: var(--accent); color: white; }

/* ‚îÄ‚îÄ FEATURE SCROLL (Camera Strip) ‚îÄ‚îÄ */
.feature-scroll {
  display: flex; gap: 12px;
  padding: 0 24px 20px;
  overflow-x: auto;
  scrollbar-width: none;
  -webkit-overflow-scrolling: touch;
}
.feature-scroll::-webkit-scrollbar { display: none; }

.feature-card {
  flex-shrink: 0;
  width: 200px; height: 130px;
  border-radius: var(--radius);
  overflow: hidden;
  position: relative;
  cursor: pointer;
  box-shadow: var(--shadow-md);
  transition: transform 0.3s;
}
.feature-card:hover { transform: scale(1.03); }
.feature-card img {
  width: 100%; height: 100%; object-fit: cover;
}
.feature-card-overlay {
  position: absolute; inset: 0;
  background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, transparent 55%);
}
.feature-card-label {
  position: absolute; bottom: 10px; left: 12px;
  color: white; font-size: 0.75rem; font-weight: 600;
  display: flex; align-items: center; gap: 6px;
}
.live-dot {
  width: 7px; height: 7px; border-radius: 50%;
  background: var(--green);
  box-shadow: 0 0 6px var(--green);
  animation: pulse 1.5s infinite;
}
@keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.5;transform:scale(0.8)} }

.feature-card-add {
  flex-shrink: 0;
  width: 130px; height: 130px;
  border-radius: var(--radius);
  border: 2px dashed var(--border);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  gap: 6px; cursor: pointer;
  transition: all 0.3s;
  background: var(--card);
}
.feature-card-add:hover { border-color: var(--accent); background: var(--accent-light); }
.feature-card-add span { font-size: 1.6rem; }
.feature-card-add p { font-size: 0.68rem; color: var(--text2); font-weight: 600; }

/* ‚îÄ‚îÄ ROOM TABS ‚îÄ‚îÄ */
.room-tabs {
  display: flex; gap: 8px;
  padding: 0 24px 16px;
  overflow-x: auto; scrollbar-width: none;
}
.room-tabs::-webkit-scrollbar { display: none; }
.room-tab {
  flex-shrink: 0;
  padding: 8px 18px; border-radius: 100px;
  font-size: 0.78rem; font-weight: 600;
  border: 1.5px solid var(--border);
  background: var(--card);
  color: var(--text2);
  cursor: pointer; transition: all 0.2s;
  white-space: nowrap;
}
.room-tab.active {
  background: var(--accent); color: white;
  border-color: var(--accent);
  box-shadow: 0 4px 14px rgba(67,97,238,0.3);
}
.room-tab:hover:not(.active) { border-color: var(--accent); color: var(--accent); }

/* ‚îÄ‚îÄ DEVICE GRID (Photo Grid) ‚îÄ‚îÄ */
.device-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  padding: 0 24px 20px;
}
.device-card {
  background: var(--card);
  border-radius: var(--radius-sm);
  padding: 14px 12px;
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
  cursor: pointer; transition: all 0.25s;
  display: flex; flex-direction: column; gap: 6px;
}
.device-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); }
.device-card.on { border-color: transparent; }
.device-card.on.blue { background: linear-gradient(135deg, var(--accent), #7c8ff5); color: white; }
.device-card.on.orange { background: linear-gradient(135deg, var(--orange), #fbbf24); color: white; }
.device-card.on.teal { background: linear-gradient(135deg, var(--teal), #34d399); color: white; }
.device-card.on.pink { background: linear-gradient(135deg, var(--pink), #f472b6); color: white; }
.device-icon { font-size: 1.3rem; }
.device-name { font-size: 0.72rem; font-weight: 700; }
.device-val { font-size: 0.62rem; opacity: 0.8; }
.device-toggle {
  align-self: flex-end;
  width: 28px; height: 16px; border-radius: 100px;
  background: rgba(255,255,255,0.3); position: relative;
  cursor: pointer; transition: background 0.3s; flex-shrink: 0;
}
.device-toggle::after {
  content: ''; position: absolute;
  top: 2px; left: 2px;
  width: 12px; height: 12px; border-radius: 50%;
  background: white; transition: left 0.3s;
  box-shadow: 0 1px 4px rgba(0,0,0,0.2);
}
.device-toggle.on::after { left: 14px; }
.device-toggle.off { background: var(--border); }
.device-toggle.off::after { background: var(--text3); }

/* ‚îÄ‚îÄ PHOTO GALLERY ‚îÄ‚îÄ */
.gallery-wrap {
  padding: 0 24px 20px;
}
.photo-masonry {
  columns: 2; column-gap: 10px;
}
.photo-masonry.col3 { columns: 3; }
.photo-item {
  break-inside: avoid; margin-bottom: 10px;
  border-radius: 14px; overflow: hidden;
  position: relative; cursor: pointer;
  box-shadow: var(--shadow);
  transition: transform 0.3s, box-shadow 0.3s;
  background: var(--card);
}
.photo-item:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); }
.photo-item img { width: 100%; height: auto; display: block; transition: transform 0.5s; }
.photo-item:hover img { transform: scale(1.05); }
.photo-overlay {
  position: absolute; inset: 0;
  background: linear-gradient(to top, rgba(26,29,46,0.75) 0%, transparent 55%);
  opacity: 0; transition: opacity 0.3s;
  display: flex; flex-direction: column;
  justify-content: flex-end; padding: 10px;
}
.photo-item:hover .photo-overlay { opacity: 1; }
.photo-date { font-size: 0.6rem; color: rgba(255,255,255,0.7); font-weight: 500; margin-bottom: 4px; }
.photo-actions { display: flex; gap: 4px; }
.photo-act-btn {
  background: rgba(255,255,255,0.15);
  border: 1px solid rgba(255,255,255,0.2);
  color: white; padding: 3px 8px;
  border-radius: 100px; font-size: 0.58rem; font-weight: 700;
  cursor: pointer; backdrop-filter: blur(6px);
  transition: all 0.2s; font-family: inherit;
}
.photo-act-btn:hover { background: white; color: var(--text); }
.photo-act-btn.del:hover { background: #ef4444; border-color: #ef4444; color: white; }

/* ‚îÄ‚îÄ UPLOAD AREA ‚îÄ‚îÄ */
.upload-area {
  margin: 0 24px 20px;
  border: 2px dashed var(--border);
  border-radius: var(--radius);
  padding: 28px 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s;
  background: var(--card);
}
.upload-area:hover, .upload-area.drag-over {
  border-color: var(--accent);
  background: var(--accent-light);
}
.upload-icon { font-size: 2rem; margin-bottom: 8px; }
.upload-title { font-size: 0.85rem; font-weight: 700; color: var(--text); margin-bottom: 4px; }
.upload-sub { font-size: 0.72rem; color: var(--text2); margin-bottom: 14px; }
.upload-btn {
  display: inline-flex; align-items: center; gap: 6px;
  background: var(--accent); color: white;
  padding: 9px 20px; border-radius: 100px;
  font-size: 0.75rem; font-weight: 700;
  border: none; cursor: pointer; font-family: inherit;
  box-shadow: 0 4px 14px rgba(67,97,238,0.35);
  transition: all 0.2s;
}
.upload-btn:hover { background: var(--accent2); transform: translateY(-1px); }

.progress-wrap { margin-top: 14px; display: none; }
.progress-bar { height: 4px; background: var(--border); border-radius: 100px; overflow: hidden; }
.progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent), var(--teal)); border-radius: 100px; width: 0; transition: width 0.3s; }
.progress-label { font-size: 0.68rem; color: var(--text2); margin-top: 6px; font-weight: 600; }

/* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
.empty-state {
  text-align: center; padding: 40px 20px;
}
.empty-icon { font-size: 3rem; margin-bottom: 12px; }
.empty-title { font-size: 1rem; font-weight: 700; margin-bottom: 6px; }
.empty-sub { font-size: 0.78rem; color: var(--text2); }

/* ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ */
.bottom-nav {
  position: fixed; bottom: 0; left: 50%;
  transform: translateX(-50%);
  width: 100%; max-width: 430px;
  background: var(--card);
  border-top: 1px solid var(--border);
  display: flex; align-items: stretch;
  z-index: 100;
  box-shadow: 0 -8px 32px rgba(0,0,0,0.08);
  padding-bottom: env(safe-area-inset-bottom, 0);
}
.nav-item {
  flex: 1;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  gap: 3px; padding: 12px 8px;
  cursor: pointer; transition: all 0.2s;
  border: none; background: transparent; font-family: inherit;
  color: var(--text2); position: relative;
}
.nav-item:hover { color: var(--accent); }
.nav-item.active { color: var(--accent); }
.nav-item.active::before {
  content: ''; position: absolute; top: 0; left: 50%;
  transform: translateX(-50%);
  width: 28px; height: 3px; border-radius: 0 0 4px 4px;
  background: var(--accent);
}
.nav-icon { font-size: 1.3rem; line-height: 1; }
.nav-label { font-size: 0.58rem; font-weight: 600; letter-spacing: 0.02em; }

/* ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ */
.page { display: none; flex: 1; overflow-y: auto; padding-bottom: 80px; }
.page.active { display: block; }

/* ‚îÄ‚îÄ SETTINGS PAGE ‚îÄ‚îÄ */
.settings-section {
  margin: 0 24px 16px;
}
.settings-group {
  background: var(--card);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  overflow: hidden;
  box-shadow: var(--shadow);
}
.settings-item {
  display: flex; align-items: center; justify-content: space-between;
  padding: 14px 16px; border-bottom: 1px solid var(--border);
  cursor: pointer; transition: background 0.2s;
}
.settings-item:last-child { border-bottom: none; }
.settings-item:hover { background: var(--bg); }
.settings-item-left { display: flex; align-items: center; gap: 12px; }
.settings-item-icon {
  width: 36px; height: 36px; border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1rem;
}
.si-blue { background: #dbeafe; }
.si-purple { background: #ede9fe; }
.si-green { background: #dcfce7; }
.si-orange { background: #ffedd5; }
.si-pink { background: #fce7f3; }
.si-red { background: #fee2e2; }
.settings-item-text h4 { font-size: 0.82rem; font-weight: 600; color: var(--text); }
.settings-item-text p { font-size: 0.68rem; color: var(--text2); margin-top: 1px; }
.settings-item-right { display: flex; align-items: center; gap: 8px; color: var(--text3); font-size: 0.85rem; }

/* Toggle Switch */
.toggle-switch {
  width: 44px; height: 24px; border-radius: 100px;
  background: var(--border); position: relative; cursor: pointer;
  transition: background 0.3s; flex-shrink: 0;
}
.toggle-switch.on { background: var(--accent); }
.toggle-switch::after {
  content: ''; position: absolute;
  top: 3px; left: 3px;
  width: 18px; height: 18px; border-radius: 50%;
  background: white;
  box-shadow: 0 1px 4px rgba(0,0,0,0.2);
  transition: left 0.3s;
}
.toggle-switch.on::after { left: 23px; }

/* Color theme picker */
.theme-colors {
  display: flex; gap: 8px; padding: 16px;
  flex-wrap: wrap;
}
.color-dot {
  width: 30px; height: 30px; border-radius: 50%;
  cursor: pointer; transition: all 0.2s;
  border: 3px solid transparent;
  position: relative;
}
.color-dot.active { border-color: var(--text); transform: scale(1.15); }
.color-dot:hover { transform: scale(1.1); }

/* ‚îÄ‚îÄ MEMORIES / DETAIL PAGE ‚îÄ‚îÄ */
.memory-hero {
  position: relative; height: 260px; overflow: hidden;
}
.memory-hero img { width: 100%; height: 100%; object-fit: cover; }
.memory-hero-overlay {
  position: absolute; inset: 0;
  background: linear-gradient(to top, rgba(26,29,46,0.85) 0%, transparent 50%);
}
.memory-hero-back {
  position: absolute; top: 52px; left: 20px;
  width: 36px; height: 36px; border-radius: 50%;
  background: rgba(255,255,255,0.2); backdrop-filter: blur(8px);
  border: 1px solid rgba(255,255,255,0.3);
  color: white; display: flex; align-items: center; justify-content: center;
  font-size: 1rem; cursor: pointer;
}
.memory-hero-title {
  position: absolute; bottom: 20px; left: 20px; right: 20px;
  color: white;
}
.memory-hero-title h2 { font-family: 'DM Serif Display', serif; font-size: 1.4rem; font-weight: 400; }
.memory-hero-title p { font-size: 0.72rem; opacity: 0.75; margin-top: 2px; }

/* ‚îÄ‚îÄ MOOD BOARD / TRIBUTE ‚îÄ‚îÄ */
.tribute-card {
  margin: 0 24px 16px;
  background: linear-gradient(135deg, #1a1d2e 0%, #2d1b69 100%);
  border-radius: var(--radius);
  padding: 24px;
  color: white;
  position: relative; overflow: hidden;
}
.tribute-card::before {
  content: '‚ú¶';
  position: absolute; top: 16px; right: 20px;
  font-size: 2.5rem; opacity: 0.15;
}
.tribute-card h3 { font-family: 'DM Serif Display', serif; font-size: 1.2rem; font-weight: 400; margin-bottom: 8px; }
.tribute-card p { font-size: 0.78rem; opacity: 0.7; line-height: 1.6; }
.tribute-years { font-size: 0.65rem; margin-top: 12px; opacity: 0.5; font-weight: 600; letter-spacing: 0.08em; text-transform: uppercase; }

/* ‚îÄ‚îÄ SEARCH ‚îÄ‚îÄ */
.search-bar {
  margin: 0 24px 16px;
  background: var(--card);
  border: 1.5px solid var(--border);
  border-radius: 100px;
  display: flex; align-items: center; gap: 10px;
  padding: 10px 16px;
  box-shadow: var(--shadow);
  transition: border-color 0.2s;
}
.search-bar:focus-within { border-color: var(--accent); }
.search-bar span { font-size: 1rem; color: var(--text2); }
.search-bar input {
  border: none; background: transparent;
  font-family: inherit; font-size: 0.82rem;
  color: var(--text); flex: 1; outline: none;
}
.search-bar input::placeholder { color: var(--text3); }

/* ‚îÄ‚îÄ FILTER PILLS ‚îÄ‚îÄ */
.filter-pills {
  display: flex; gap: 6px;
  padding: 0 24px 16px;
  overflow-x: auto; scrollbar-width: none;
}
.filter-pills::-webkit-scrollbar { display: none; }
.filter-pill {
  flex-shrink: 0;
  padding: 6px 14px; border-radius: 100px;
  font-size: 0.7rem; font-weight: 600;
  border: 1.5px solid var(--border);
  background: var(--card); color: var(--text2);
  cursor: pointer; transition: all 0.2s;
  white-space: nowrap; font-family: inherit;
}
.filter-pill.active { background: var(--accent); color: white; border-color: var(--accent); }
.filter-pill:hover:not(.active) { border-color: var(--accent); color: var(--accent); }

/* ‚îÄ‚îÄ LIGHTBOX ‚îÄ‚îÄ */
#lightbox {
  position: fixed; inset: 0;
  background: rgba(15,17,26,0.97);
  z-index: 1000; display: none;
  flex-direction: column; align-items: center; justify-content: center;
  backdrop-filter: blur(24px);
}
#lightbox.active { display: flex; }
.lb-img-wrap { position: relative; max-width: 90vw; max-height: 75vh; }
#lightboxImg {
  max-width: 90vw; max-height: 75vh;
  object-fit: contain; display: block;
  border-radius: 16px;
  box-shadow: 0 40px 80px rgba(0,0,0,0.6);
  animation: lbIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}
@keyframes lbIn { from{opacity:0;transform:scale(0.9)} to{opacity:1;transform:scale(1)} }
.lb-close {
  position: fixed; top: 20px; right: 20px;
  width: 40px; height: 40px; border-radius: 50%;
  background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
  color: white; font-size: 1rem; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: background 0.2s;
}
.lb-close:hover { background: rgba(255,255,255,0.2); }
.lb-controls {
  display: flex; align-items: center; gap: 10px; margin-top: 20px;
}
.lb-btn {
  background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
  color: white; padding: 8px 18px; border-radius: 100px;
  font-family: inherit; font-size: 0.72rem; font-weight: 700;
  cursor: pointer; transition: all 0.2s;
}
.lb-btn:hover { background: rgba(255,255,255,0.2); }
.lb-btn.danger:hover { background: #ef4444; border-color: #ef4444; }
.lb-counter {
  color: rgba(255,255,255,0.5); font-size: 0.72rem; font-weight: 600;
  min-width: 60px; text-align: center;
}

/* ‚îÄ‚îÄ SLIDESHOW BAR ‚îÄ‚îÄ */
.lb-indicator {
  display: flex; gap: 4px; margin-top: 12px;
}
.lb-dot {
  width: 5px; height: 5px; border-radius: 50%;
  background: rgba(255,255,255,0.25);
  transition: all 0.2s; cursor: pointer;
}
.lb-dot.active { background: white; width: 18px; border-radius: 3px; }

/* ‚îÄ‚îÄ SLIDESHOW MODE ‚îÄ‚îÄ */
#slideshowOverlay {
  display: none; position: fixed; inset: 0;
  background: #000; z-index: 2000;
  flex-direction: column; align-items: center; justify-content: center;
}
#slideshowOverlay.active { display: flex; }
#ssImg {
  max-width: 100vw; max-height: 90vh;
  object-fit: contain; transition: opacity 0.5s;
}
.ss-controls {
  position: fixed; bottom: 24px; left: 0; right: 0;
  display: flex; align-items: center; justify-content: center; gap: 12px;
}
.ss-btn {
  background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2);
  color: white; padding: 8px 20px; border-radius: 100px;
  font-family: inherit; font-size: 0.72rem; font-weight: 700;
  cursor: pointer;
}
.ss-close {
  position: fixed; top: 20px; right: 20px;
  width: 38px; height: 38px; border-radius: 50%;
  background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
  color: white; display: flex; align-items: center; justify-content: center;
  cursor: pointer; font-size: 1rem;
}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
#toast {
  position: fixed; bottom: 90px; left: 50%;
  transform: translateX(-50%) translateY(20px);
  background: var(--text); color: white;
  padding: 10px 20px; border-radius: 100px;
  font-size: 0.75rem; font-weight: 600;
  z-index: 5000; opacity: 0;
  transition: all 0.3s; pointer-events: none;
  white-space: nowrap; box-shadow: var(--shadow-lg);
  display: flex; align-items: center; gap: 6px;
}
#toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
#toast.ok { background: var(--green); }
#toast.err { background: #ef4444; }

/* ‚îÄ‚îÄ BADGE ‚îÄ‚îÄ */
.badge {
  background: var(--accent);
  color: white; font-size: 0.55rem; font-weight: 800;
  width: 16px; height: 16px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  position: absolute; top: 6px; right: 6px;
  box-shadow: 0 2px 6px rgba(67,97,238,0.4);
}

/* ‚îÄ‚îÄ PAGE HEADER ‚îÄ‚îÄ */
.page-header {
  padding: 52px 24px 16px;
  display: flex; align-items: center; gap: 12px;
}
.page-header h2 {
  font-family: 'DM Serif Display', serif;
  font-size: 1.4rem; font-weight: 400; color: var(--text);
}
.page-header-sub { font-size: 0.72rem; color: var(--text2); margin-top: 2px; }

/* ‚îÄ‚îÄ NOTICE CARD ‚îÄ‚îÄ */
.notice-card {
  margin: 0 24px 16px;
  background: var(--accent-light);
  border: 1px solid rgba(67,97,238,0.2);
  border-radius: var(--radius-sm);
  padding: 12px 14px;
  display: flex; align-items: flex-start; gap: 10px;
}
.notice-icon { font-size: 1rem; flex-shrink: 0; margin-top: 1px; }
.notice-text { font-size: 0.72rem; color: var(--accent); font-weight: 500; line-height: 1.5; }

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media (min-width: 430px) {
  .bottom-nav, .app-shell { max-width: 430px; }
}
@media (max-width: 430px) {
  .bottom-nav { max-width: 100vw; }
}

/* ‚îÄ‚îÄ LAYOUT TOGGLE GALLERY ‚îÄ‚îÄ */
.gallery-controls {
  display: flex; align-items: center; gap: 6px;
  padding: 0 24px 12px;
}
.layout-btns {
  display: flex; background: var(--card); border: 1px solid var(--border);
  border-radius: 10px; padding: 3px; gap: 2px; box-shadow: var(--shadow);
  margin-left: auto;
}
.lbtn {
  width: 28px; height: 28px; border-radius: 7px;
  border: none; background: transparent;
  color: var(--text2); font-size: 0.68rem; font-weight: 800;
  cursor: pointer; transition: all 0.2s; font-family: inherit;
  display: flex; align-items: center; justify-content: center;
}
.lbtn.active { background: var(--accent); color: white; }
.lbtn:hover:not(.active) { background: var(--bg); color: var(--text); }

/* ‚îÄ‚îÄ PROFILE PAGE ‚îÄ‚îÄ */
.profile-hero {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  padding: 60px 24px 40px;
  text-align: center; color: white;
}
.profile-avatar-large {
  width: 80px; height: 80px; border-radius: 50%;
  background: rgba(255,255,255,0.25);
  border: 3px solid rgba(255,255,255,0.5);
  margin: 0 auto 14px;
  display: flex; align-items: center; justify-content: center;
  font-size: 2rem;
  overflow: hidden;
}
.profile-avatar-large img { width: 100%; height: 100%; object-fit: cover; }
.profile-name { font-family: 'DM Serif Display', serif; font-size: 1.6rem; font-weight: 400; margin-bottom: 4px; }
.profile-tagline { font-size: 0.78rem; opacity: 0.75; }

::-webkit-scrollbar { width: 0; height: 0; }
::selection { background: rgba(67,97,238,0.2); color: var(--accent); }

/* animations */
.page.active .device-card,
.page.active .photo-item,
.page.active .stat-card {
  animation: fadeUp 0.4s ease both;
}
@keyframes fadeUp { from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:translateY(0)} }
</style>
</head>
<body>
<div class="app-shell">

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HOME PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page active" id="page-home">
    <!-- Topbar -->
    <div class="topbar">
      <div class="topbar-left">
        <div class="avatar" id="avatarBtn">B</div>
        <div class="topbar-greeting">
          <h1>Hi, Bayu üåø</h1>
          <p>Kenangan abadi di sini</p>
        </div>
      </div>
      <div class="topbar-actions">
        <button class="icon-btn" onclick="toggleTheme()" title="Ganti tema">üåô</button>
        <button class="icon-btn primary" onclick="gotoPage('gallery')" title="Upload">Ôºã</button>
      </div>
    </div>

    <!-- Stats -->
    <div class="stats-bar">
      <div class="stat-card">
        <div class="stat-icon">üñºÔ∏è</div>
        <div class="stat-num" id="statPhotos">0</div>
        <div class="stat-label">Foto</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üìÖ</div>
        <div class="stat-num" id="statDays">-</div>
        <div class="stat-label">Hari</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üíæ</div>
        <div class="stat-num" id="statSize">0 MB</div>
        <div class="stat-label">Storage</div>
      </div>
    </div>

    <!-- Tribute Card -->
    <div class="tribute-card">
      <h3>In Memory of Bayu ‚ú¶</h3>
      <p>Setiap foto adalah cahaya yang tidak pernah padam. Kenangan ini akan selalu hidup di hati kita.</p>
      <div class="tribute-years">Selalu dikenang ¬∑ Selalu dicintai</div>
    </div>

    <!-- Recent Photos (Camera Strip) -->
    <div class="section-header">
      <span class="section-title">Foto Terbaru</span>
      <button class="section-link" onclick="gotoPage('gallery')">Lihat Semua</button>
    </div>
    <div class="feature-scroll" id="recentStrip">
      <div class="feature-card-add" onclick="gotoPage('gallery')">
        <span>üì∑</span>
        <p>Upload Foto</p>
      </div>
    </div>

    <!-- Rooms / Albums -->
    <div class="section-header">
      <span class="section-title">Album</span>
      <button class="section-link" onclick="gotoPage('gallery')">Kelola</button>
    </div>
    <div class="room-tabs" id="albumTabs">
      <div class="room-tab active" onclick="filterAlbum('', this)">Semua</div>
      <div class="room-tab" onclick="filterAlbum('keluarga', this)">Keluarga</div>
      <div class="room-tab" onclick="filterAlbum('momen', this)">Momen</div>
      <div class="room-tab" onclick="filterAlbum('kenangan', this)">Kenangan</div>
      <div class="room-tab" onclick="filterAlbum('favorit', this)">Favorit ‚≠ê</div>
    </div>

    <!-- Quick Actions -->
    <div class="section-header">
      <span class="section-title">Aksi Cepat</span>
    </div>
    <div class="device-grid">
      <div class="device-card on blue" onclick="gotoPage('slideshow')">
        <div class="device-icon">‚ñ∂Ô∏è</div>
        <div class="device-name">Slideshow</div>
        <div class="device-val">Putar semua</div>
      </div>
      <div class="device-card on orange" onclick="downloadAll()">
        <div class="device-icon">‚¨áÔ∏è</div>
        <div class="device-name">Download</div>
        <div class="device-val">Semua foto</div>
      </div>
      <div class="device-card on teal" onclick="shareGallery()">
        <div class="device-icon">üîó</div>
        <div class="device-name">Bagikan</div>
        <div class="device-val">Link galeri</div>
      </div>
      <div class="device-card" onclick="gotoPage('gallery')">
        <div class="device-icon">üñºÔ∏è</div>
        <div class="device-name">Galeri</div>
        <div class="device-val">Lihat semua</div>
        <div class="device-toggle on"></div>
      </div>
      <div class="device-card" onclick="openSearch()">
        <div class="device-icon">üîç</div>
        <div class="device-name">Cari Foto</div>
        <div class="device-val">Pencarian</div>
        <div class="device-toggle off"></div>
      </div>
      <div class="device-card" onclick="gotoPage('settings')">
        <div class="device-icon">‚öôÔ∏è</div>
        <div class="device-name">Pengaturan</div>
        <div class="device-val">Konfigurasi</div>
        <div class="device-toggle off"></div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GALLERY PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-gallery">
    <div class="page-header">
      <div>
        <h2>Galeri Foto</h2>
        <div class="page-header-sub" id="gallerySubtitle">0 foto tersimpan</div>
      </div>
    </div>

    <!-- Upload Area -->
    <div class="upload-area" id="dropArea">
      <div class="upload-icon">üì§</div>
      <div class="upload-title">Seret & lepas foto di sini</div>
      <div class="upload-sub">JPG, PNG, WEBP ¬∑ Bisa banyak sekaligus</div>
      <label class="upload-btn">
        Ôºã Pilih Foto
        <input type="file" id="fileInput" multiple accept="image/*" style="display:none">
      </label>
      <div class="progress-wrap" id="progressWrap">
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        <div class="progress-label" id="progressLabel">Mengunggah...</div>
      </div>
    </div>

    <!-- Search & Filters -->
    <div class="search-bar">
      <span>üîç</span>
      <input type="text" placeholder="Cari foto..." id="searchInput" oninput="filterPhotos()">
    </div>
    <div class="filter-pills">
      <button class="filter-pill active" onclick="setFilter('all', this)">Semua</button>
      <button class="filter-pill" onclick="setFilter('recent', this)">Terbaru</button>
      <button class="filter-pill" onclick="setFilter('oldest', this)">Terlama</button>
      <button class="filter-pill" onclick="setFilter('keluarga', this)">Keluarga</button>
      <button class="filter-pill" onclick="setFilter('momen', this)">Momen</button>
      <button class="filter-pill" onclick="setFilter('favorit', this)">Favorit ‚≠ê</button>
    </div>

    <!-- Gallery Controls -->
    <div class="gallery-controls">
      <span class="section-title" id="photoCountEl">0 Foto</span>
      <div class="layout-btns">
        <button class="lbtn" onclick="setLayout(1, this)">‚ò∞</button>
        <button class="lbtn active" onclick="setLayout(2, this)">‚äû</button>
        <button class="lbtn" onclick="setLayout(3, this)">‚äü</button>
      </div>
    </div>

    <!-- Photo Grid -->
    <div class="gallery-wrap">
      <div class="photo-masonry" id="photoGrid">
        <div class="empty-state">
          <div class="empty-icon">üåÖ</div>
          <div class="empty-title">Belum ada foto</div>
          <div class="empty-sub">Upload foto pertama untuk memulai kenangan indah</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MEMORIES PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-memories">
    <div class="page-header">
      <div>
        <h2>Kenangan</h2>
        <div class="page-header-sub">Momen spesial tersimpan</div>
      </div>
    </div>

    <div class="notice-card">
      <div class="notice-icon">üí°</div>
      <div class="notice-text">Kenangan terbaik dari koleksi foto. Beri tanda ‚≠ê pada foto untuk menampilkannya di sini.</div>
    </div>

    <!-- Slideshow preview -->
    <div class="section-header">
      <span class="section-title">Slideshow Otomatis</span>
    </div>
    <div style="margin: 0 24px 16px; background: linear-gradient(135deg, #0f172a, #1e1b4b); border-radius: var(--radius); padding: 24px; color: white; cursor: pointer; position: relative; overflow: hidden;" onclick="startSlideshow()">
      <div style="font-size: 2.5rem; margin-bottom: 10px;">‚ñ∂Ô∏è</div>
      <div style="font-weight: 700; font-size: 1rem; margin-bottom: 4px;">Putar Slideshow</div>
      <div style="font-size: 0.75rem; opacity: 0.6;">Tampilkan semua foto secara otomatis</div>
      <div style="position:absolute;right:-10px;bottom:-10px;font-size:5rem;opacity:0.08;">üéûÔ∏è</div>
    </div>

    <!-- Favorite photos -->
    <div class="section-header">
      <span class="section-title">Foto Favorit ‚≠ê</span>
    </div>
    <div class="gallery-wrap">
      <div class="photo-masonry" id="favGrid">
        <div class="empty-state">
          <div class="empty-icon">‚≠ê</div>
          <div class="empty-title">Belum ada favorit</div>
          <div class="empty-sub">Klik ‚≠ê pada foto untuk menandai sebagai favorit</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SETTINGS PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-settings">
    <div class="page-header">
      <div>
        <h2>Pengaturan</h2>
        <div class="page-header-sub">Kustomisasi galeri Anda</div>
      </div>
    </div>

    <!-- Profile Section -->
    <div class="settings-section">
      <div style="font-size:0.65rem;font-weight:700;color:var(--text2);letter-spacing:0.08em;text-transform:uppercase;margin-bottom:8px;padding:0 4px;">Profil</div>
      <div class="settings-group">
        <div class="settings-item">
          <div class="settings-item-left">
            <div class="settings-item-icon si-blue">üë§</div>
            <div class="settings-item-text">
              <h4>Nama Galeri</h4>
              <p>In Memory of Bayu</p>
            </div>
          </div>
          <div class="settings-item-right">‚Ä∫</div>
        </div>
        <div class="settings-item">
          <div class="settings-item-left">
            <div class="settings-item-icon si-purple">üñºÔ∏è</div>
            <div class="settings-item-text">
              <h4>Foto Profil</h4>
              <p>Ubah avatar</p>
            </div>
          </div>
          <div class="settings-item-right">
            <label style="cursor:pointer;font-size:0.7rem;color:var(--accent);font-weight:600;">
              Pilih
              <input type="file" accept="image/*" id="avatarInput" style="display:none" onchange="changeAvatar(event)">
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- Appearance -->
    <div class="settings-section">
      <div style="font-size:0.65rem;font-weight:700;color:var(--text2);letter-spacing:0.08em;text-transform:uppercase;margin-bottom:8px;padding:0 4px;">Tampilan</div>
      <div class="settings-group">
        <div class="settings-item">
          <div class="settings-item-left">
            <div class="settings-item-icon si-purple">üåô</div>
            <div class="settings-item-text">
              <h4>Mode Gelap</h4>
              <p>Aktifkan dark mode</p>
            </div>
          </div>
          <div class="settings-item-right">
            <div class="toggle-switch" id="darkToggle" onclick="toggleTheme()"></div>
          </div>
        </div>
        <div class="settings-item" style="cursor:default;">
          <div class="settings-item-left" style="width:100%;flex-direction:column;align-items:flex-start;gap:10px;">
            <div style="display:flex;align-items:center;gap:12px;width:100%;">
              <div class="settings-item-icon si-orange">üé®</div>
              <div class="settings-item-text">
                <h4>Warna Aksen</h4>
                <p>Pilih warna tema</p>
              </div>
            </div>
            <div class="theme-colors">
              <div class="color-dot active" style="background:#4361ee;" onclick="setAccent('#4361ee','#dbeafe',this)" title="Biru"></div>
              <div class="color-dot" style="background:#7c3aed;" onclick="setAccent('#7c3aed','#ede9fe',this)" title="Ungu"></div>
              <div class="color-dot" style="background:#ec4899;" onclick="setAccent('#ec4899','#fce7f3',this)" title="Pink"></div>
              <div class="color-dot" style="background:#14b8a6;" onclick="setAccent('#14b8a6','#ccfbf1',this)" title="Teal"></div>
              <div class="color-dot" style="background:#22c55e;" onclick="setAccent('#22c55e','#dcfce7',this)" title="Hijau"></div>
              <div class="color-dot" style="background:#f97316;" onclick="setAccent('#f97316','#ffedd5',this)" title="Orange"></div>
              <div class="color-dot" style="background:#ef4444;" onclick="setAccent('#ef4444','#fee2e2',this)" title="Merah"></div>
              <div class="color-dot" style="background:#1a1d2e;" onclick="setAccent('#1a1d2e','#e5e7eb',this)" title="Hitam"></div>
            </div>
          </div>
        </div>
        <div class="settings-item">
          <div class="settings-item-left">
            <div class="settings-item-icon si-blue">üìê</div>
            <div class="settings-item-text">
              <h4>Kolom Galeri</h4>
              <p id="colLabel">2 kolom</p>
            </div>
          </div>
          <div class="settings-item-right">
            <div style="display:flex;gap:6px;">
              <button onclick="setLayout(1,null,true)" style="padding:4px 10px;border-radius:6px;border:1px solid var(--border);background:var(--bg);font-size:0.7rem;cursor:pointer;font-family:inherit;color:var(--text);">1</button>
              <button onclick="setLayout(2,null,true)" style="padding:4px 10px;border-radius:6px;border:1px solid var(--border);background:var(--bg);font-size:0.7rem;cursor:pointer;font-family:inherit;color:var(--text);">2</button>
              <button onclick="setLayout(3,null,true)" style="padding:4px 10px;border-radius:6px;border:1px solid var(--border);background:var(--bg);font-size:0.7rem;cursor:pointer;font-family:inherit;color:var(--text);">3</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Gallery Settings -->
    <div class="settings-section">
      <div style="font-size:0.65rem;font-weight:700;color:var(--text2);letter-spacing:0.08em;text-transform:uppercase;margin-bottom:8px;padding:0 4px;">Galeri</div>
      <div class="settings-group">
        <div class="settings-item">
          <div class="settings-item-left">
            <div class="settings-item-icon si-teal">‚ñ∂Ô∏è</div>
            <div class="settings-item-text">
              <h4>Putar Slideshow</h4>
              <p>Tampilkan semua foto</p>
            </div>
          </div>
          <div class="settings-item-right">
            <button onclick="startSlideshow()" style="padding:5px 14px;border-radius:100px;background:var(--accent);color:white;border:none;font-size:0.7rem;font-weight:700;cursor:pointer;font-family:inherit;">Putar</button>
          </div>
        </div>
        <div class="settings-item">
          <div class="settings-item-left">
            <div class="settings-item-icon si-green">‚¨áÔ∏è</div>
            <div class="settings-item-text">
              <h4>Download Semua</h4>
              <p>Unduh seluruh galeri</p>
            </div>
          </div>
          <div class="settings-item-right">
            <button onclick="downloadAll()" style="padding:5px 14px;border-radius:100px;background:var(--accent);color:white;border:none;font-size:0.7rem;font-weight:700;cursor:pointer;font-family:inherit;">Unduh</button>
          </div>
        </div>
        <div class="settings-item" onclick="clearAll()" style="cursor:pointer;">
          <div class="settings-item-left">
            <div class="settings-item-icon si-red">üóëÔ∏è</div>
            <div class="settings-item-text">
              <h4>Hapus Semua Foto</h4>
              <p>Tidak bisa dikembalikan</p>
            </div>
          </div>
          <div class="settings-item-right" style="color:#ef4444;">Hapus</div>
        </div>
      </div>
    </div>

    <!-- About -->
    <div class="settings-section">
      <div class="settings-group">
        <div class="settings-item" style="cursor:default;">
          <div class="settings-item-left">
            <div class="settings-item-icon si-purple">‚ÑπÔ∏è</div>
            <div class="settings-item-text">
              <h4>Tentang Aplikasi</h4>
              <p>In Memory of Bayu ¬∑ v2.0</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div style="text-align:center;padding:24px;font-size:0.72rem;color:var(--text3);">
      Dibuat dengan ‚ù§Ô∏è untuk mengenang <strong style="color:var(--accent);">Bayu</strong>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BOTTOM NAV ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <nav class="bottom-nav">
    <button class="nav-item active" onclick="gotoPage('home')" id="nav-home">
      <span class="nav-icon">üè†</span>
      <span class="nav-label">Beranda</span>
    </button>
    <button class="nav-item" onclick="gotoPage('gallery')" id="nav-gallery">
      <span class="nav-icon">üñºÔ∏è</span>
      <span class="nav-label">Galeri</span>
      <span class="badge" id="photoBadge" style="display:none">0</span>
    </button>
    <button class="nav-item" onclick="gotoPage('memories')" id="nav-memories">
      <span class="nav-icon">‚≠ê</span>
      <span class="nav-label">Kenangan</span>
    </button>
    <button class="nav-item" onclick="gotoPage('settings')" id="nav-settings">
      <span class="nav-icon">‚öôÔ∏è</span>
      <span class="nav-label">Pengaturan</span>
    </button>
  </nav>

</div><!-- /.app-shell -->

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LIGHTBOX ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="lightbox">
  <button class="lb-close" onclick="closeLightbox()">‚úï</button>
  <div class="lb-img-wrap">
    <img id="lightboxImg" src="" alt="">
  </div>
  <div class="lb-controls">
    <button class="lb-btn" id="lbPrev" onclick="lbNav(-1)">‚Üê Prev</button>
    <span class="lb-counter" id="lbCounter">1/1</span>
    <button class="lb-btn" id="lbNext" onclick="lbNav(1)">Next ‚Üí</button>
  </div>
  <div class="lb-controls" style="margin-top:6px;">
    <button class="lb-btn" onclick="lbDownload()">‚¨á Unduh</button>
    <button class="lb-btn" onclick="lbFavorite()">‚≠ê Favorit</button>
    <button class="lb-btn danger" onclick="lbDelete()">üóë Hapus</button>
  </div>
  <div class="lb-indicator" id="lbIndicator"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SLIDESHOW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="slideshowOverlay">
  <button class="ss-close" onclick="stopSlideshow()">‚úï</button>
  <img id="ssImg" src="" alt="">
  <div class="ss-controls">
    <button class="ss-btn" onclick="ssNav(-1)">‚Üê Prev</button>
    <button class="ss-btn" id="ssPauseBtn" onclick="ssPause()">‚è∏ Pause</button>
    <button class="ss-btn" onclick="ssNav(1)">Next ‚Üí</button>
  </div>
</div>

<!-- TOAST -->
<div id="toast"></div>

<!-- File input hidden -->
<input type="file" id="fileInput2" multiple accept="image/*" style="display:none">

<script>
// ‚îÄ‚îÄ SUPABASE ‚îÄ‚îÄ
const SUPABASE_URL = 'https://olkokmuburmgslpsiwpi.supabase.co';
const SUPABASE_KEY = 'sb_publishable_FHgCHk8ocJPkEGWUiejlCA_BHRcN17v';
const BUCKET = 'images';
const { createClient } = supabase;
const sb = createClient(SUPABASE_URL, SUPABASE_KEY);

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ
let photos = [];
let favorites = JSON.parse(localStorage.getItem('favs') || '[]');
let currentFilter = 'all';
let currentCols = 2;
let lightboxIdx = 0;
let ssIdx = 0, ssTimer = null, ssPaused = false;
let toastTimer = null;

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ
function toast(msg, type = '') {
  clearTimeout(toastTimer);
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.className = 'show ' + type;
  toastTimer = setTimeout(() => el.className = '', 3200);
}

// ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ
function gotoPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + name)?.classList.add('active');
  document.getElementById('nav-' + name)?.classList.add('active');
  if (name === 'memories') renderFavGrid();
}

// ‚îÄ‚îÄ THEME ‚îÄ‚îÄ
function toggleTheme() {
  const html = document.documentElement;
  const isDark = html.getAttribute('data-theme') === 'dark';
  html.setAttribute('data-theme', isDark ? '' : 'dark');
  document.getElementById('darkToggle').classList.toggle('on', !isDark);
  localStorage.setItem('theme', isDark ? '' : 'dark');
  document.querySelector('[onclick="toggleTheme()"]').textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
}

// Restore theme
(function() {
  const t = localStorage.getItem('theme');
  if (t === 'dark') {
    document.documentElement.setAttribute('data-theme', 'dark');
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('darkToggle')?.classList.add('on');
    });
  }
})();

// ‚îÄ‚îÄ ACCENT COLOR ‚îÄ‚îÄ
function setAccent(color, light, el) {
  document.documentElement.style.setProperty('--accent', color);
  document.documentElement.style.setProperty('--accent-light', light);
  document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
  el?.classList.add('active');
  localStorage.setItem('accent', JSON.stringify({color, light}));
}

(function() {
  const a = JSON.parse(localStorage.getItem('accent') || 'null');
  if (a) {
    document.documentElement.style.setProperty('--accent', a.color);
    document.documentElement.style.setProperty('--accent-light', a.light);
  }
})();

// ‚îÄ‚îÄ AVATAR ‚îÄ‚îÄ
function changeAvatar(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (ev) => {
    const src = ev.target.result;
    const avatarEl = document.getElementById('avatarBtn');
    avatarEl.innerHTML = `<img src="${src}" alt="avatar">`;
    localStorage.setItem('avatar', src);
  };
  reader.readAsDataURL(file);
}

(function() {
  const av = localStorage.getItem('avatar');
  if (av) document.getElementById('avatarBtn').innerHTML = `<img src="${av}" alt="avatar">`;
})();

// ‚îÄ‚îÄ LOAD PHOTOS ‚îÄ‚îÄ
async function loadPhotos() {
  try {
    const { data, error } = await sb.storage.from(BUCKET).list('', { limit: 500, sortBy: { column: 'created_at', order: 'desc' } });
    if (error) throw error;
    const imageFiles = (data || []).filter(f => f.name && /\.(jpe?g|png|webp|gif)$/i.test(f.name));
    photos = imageFiles.map(f => {
      const { data: urlData } = sb.storage.from(BUCKET).getPublicUrl(f.name);
      return { name: f.name, url: urlData.publicUrl, created: f.created_at, size: f.metadata?.size || 0 };
    });
    renderGallery();
    renderRecentStrip();
    updateStats();
  } catch(e) {
    console.error(e);
    toast('Gagal memuat foto', 'err');
  }
}

// ‚îÄ‚îÄ RENDER GALLERY ‚îÄ‚îÄ
function renderGallery() {
  const grid = document.getElementById('photoGrid');
  const filtered = getFiltered();
  document.getElementById('photoCountEl').textContent = filtered.length + ' Foto';
  document.getElementById('gallerySubtitle').textContent = filtered.length + ' foto tersimpan';

  if (!filtered.length) {
    grid.innerHTML = `<div class="empty-state"><div class="empty-icon">üåÖ</div><div class="empty-title">Tidak ada foto</div><div class="empty-sub">Coba filter lain atau upload foto baru</div></div>`;
    return;
  }

  grid.innerHTML = filtered.map((p, i) => `
    <div class="photo-item" style="animation-delay:${i * 0.04}s">
      <img src="${p.url}" alt="${p.name}" loading="lazy" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22><rect fill=%22%23f0f0f0%22 width=%22200%22 height=%22200%22/><text x=%2250%%22 y=%2250%%22 text-anchor=%22middle%22 dy=%220.3em%22 fill=%22%23999%22>üñºÔ∏è</text></svg>'">
      <div class="photo-overlay">
        <div class="photo-date">${formatDate(p.created)}</div>
        <div class="photo-actions">
          <button class="photo-act-btn" onclick="openLightbox(${photos.indexOf(p)});event.stopPropagation()">üîç</button>
          <button class="photo-act-btn" onclick="toggleFav('${p.name}');event.stopPropagation()">${favorites.includes(p.name) ? '‚≠ê' : '‚òÜ'}</button>
          <button class="photo-act-btn" onclick="downloadPhoto('${p.url}','${p.name}');event.stopPropagation()">‚¨á</button>
          <button class="photo-act-btn del" onclick="deletePhoto('${p.name}');event.stopPropagation()">üóë</button>
        </div>
      </div>
    </div>
  `).join('');

  // Click to open lightbox
  grid.querySelectorAll('.photo-item img').forEach((img, i) => {
    img.onclick = () => openLightbox(photos.indexOf(filtered[i]));
  });

  const badge = document.getElementById('photoBadge');
  if (photos.length) {
    badge.style.display = 'flex';
    badge.textContent = photos.length > 99 ? '99+' : photos.length;
  } else badge.style.display = 'none';
}

function renderFavGrid() {
  const grid = document.getElementById('favGrid');
  const favPhotos = photos.filter(p => favorites.includes(p.name));
  if (!favPhotos.length) {
    grid.innerHTML = `<div class="empty-state"><div class="empty-icon">‚≠ê</div><div class="empty-title">Belum ada favorit</div><div class="empty-sub">Klik ‚≠ê pada foto untuk menandai sebagai favorit</div></div>`;
    return;
  }
  grid.innerHTML = favPhotos.map((p, i) => `
    <div class="photo-item" style="animation-delay:${i*0.04}s">
      <img src="${p.url}" alt="${p.name}" loading="lazy">
      <div class="photo-overlay">
        <div class="photo-date">${formatDate(p.created)}</div>
        <div class="photo-actions">
          <button class="photo-act-btn" onclick="openLightbox(${photos.indexOf(p)});event.stopPropagation()">üîç</button>
          <button class="photo-act-btn" onclick="toggleFav('${p.name}');event.stopPropagation()">‚≠ê</button>
        </div>
      </div>
    </div>
  `).join('');
}

function renderRecentStrip() {
  const strip = document.getElementById('recentStrip');
  const recent = photos.slice(0, 8);
  const addCard = `<div class="feature-card-add" onclick="gotoPage('gallery')"><span>üì∑</span><p>Upload Foto</p></div>`;
  if (!recent.length) { strip.innerHTML = addCard; return; }
  strip.innerHTML = addCard + recent.map((p, i) => `
    <div class="feature-card" onclick="openLightbox(${i})">
      <img src="${p.url}" alt="${p.name}" loading="lazy">
      <div class="feature-card-overlay"></div>
      <div class="feature-card-label"><div class="live-dot"></div>${formatDate(p.created)}</div>
    </div>
  `).join('');
}

function updateStats() {
  document.getElementById('statPhotos').textContent = photos.length;
  const totalBytes = photos.reduce((a, p) => a + (p.size || 0), 0);
  const mb = (totalBytes / 1024 / 1024).toFixed(1);
  document.getElementById('statSize').textContent = mb + ' MB';
  // Days since first photo
  if (photos.length) {
    const earliest = new Date(Math.min(...photos.map(p => new Date(p.created).getTime())));
    const days = Math.floor((Date.now() - earliest.getTime()) / 86400000);
    document.getElementById('statDays').textContent = days;
  }
}

// ‚îÄ‚îÄ FILTER ‚îÄ‚îÄ
let activeFilter = 'all';
function setFilter(f, el) {
  activeFilter = f;
  document.querySelectorAll('.filter-pill').forEach(p => p.classList.remove('active'));
  el?.classList.add('active');
  renderGallery();
}

function getFiltered() {
  const q = document.getElementById('searchInput')?.value.toLowerCase() || '';
  let list = [...photos];
  if (activeFilter === 'recent') list.sort((a,b) => new Date(b.created) - new Date(a.created));
  else if (activeFilter === 'oldest') list.sort((a,b) => new Date(a.created) - new Date(b.created));
  else if (activeFilter === 'favorit') list = list.filter(p => favorites.includes(p.name));
  if (q) list = list.filter(p => p.name.toLowerCase().includes(q));
  return list;
}

function filterPhotos() { renderGallery(); }

function filterAlbum(tag, el) {
  document.querySelectorAll('.room-tab').forEach(t => t.classList.remove('active'));
  el?.classList.add('active');
}

function openSearch() { gotoPage('gallery'); document.getElementById('searchInput')?.focus(); }

// ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ
function setLayout(cols, btn, fromSettings = false) {
  currentCols = cols;
  const grid = document.getElementById('photoGrid');
  grid.className = 'photo-masonry' + (cols === 3 ? ' col3' : cols === 1 ? ' col1' : '');
  if (cols === 1) grid.style.columns = '1'; 
  else if (cols === 3) grid.style.columns = '3';
  else grid.style.columns = '2';
  
  if (btn) {
    document.querySelectorAll('.lbtn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
  }
  if (fromSettings) {
    document.getElementById('colLabel').textContent = cols + ' kolom';
    toast('Kolom galeri: ' + cols);
  }
}

// ‚îÄ‚îÄ UPLOAD ‚îÄ‚îÄ
const fileInput = document.getElementById('fileInput');
const dropArea = document.getElementById('dropArea');

fileInput.addEventListener('change', e => handleFiles(e.target.files));
document.getElementById('fileInput2')?.addEventListener('change', e => handleFiles(e.target.files));

['dragenter','dragover'].forEach(ev => dropArea.addEventListener(ev, e => { e.preventDefault(); dropArea.classList.add('drag-over'); }));
['dragleave','drop'].forEach(ev => dropArea.addEventListener(ev, e => { e.preventDefault(); dropArea.classList.remove('drag-over'); }));
dropArea.addEventListener('drop', e => handleFiles(e.dataTransfer.files));

async function handleFiles(files) {
  if (!files.length) return;
  const arr = Array.from(files).filter(f => f.type.startsWith('image/'));
  if (!arr.length) return toast('Hanya file gambar yang didukung', 'err');

  const pw = document.getElementById('progressWrap');
  const pf = document.getElementById('progressFill');
  const pl = document.getElementById('progressLabel');
  pw.style.display = 'block';
  let done = 0;

  for (const file of arr) {
    const name = Date.now() + '_' + file.name.replace(/[^a-zA-Z0-9._-]/g, '_');
    const { error } = await sb.storage.from(BUCKET).upload(name, file, { cacheControl: '3600', upsert: false });
    done++;
    pf.style.width = (done / arr.length * 100) + '%';
    pl.textContent = `Mengunggah ${done}/${arr.length}...`;
    if (error) toast('Gagal: ' + file.name, 'err');
  }

  pw.style.display = 'none';
  pf.style.width = '0';
  toast('‚úÖ ' + done + ' foto berhasil diunggah', 'ok');
  await loadPhotos();
}

// ‚îÄ‚îÄ DELETE ‚îÄ‚îÄ
async function deletePhoto(name) {
  if (!confirm('Hapus foto ini?')) return;
  const { error } = await sb.storage.from(BUCKET).remove([name]);
  if (error) { toast('Gagal hapus foto', 'err'); return; }
  toast('Foto dihapus', 'ok');
  favorites = favorites.filter(f => f !== name);
  localStorage.setItem('favs', JSON.stringify(favorites));
  await loadPhotos();
  closeLightbox();
}

async function clearAll() {
  if (!confirm('Hapus SEMUA foto? Tidak bisa dikembalikan!')) return;
  if (!confirm('Yakin? Ini akan menghapus ' + photos.length + ' foto!')) return;
  const names = photos.map(p => p.name);
  const { error } = await sb.storage.from(BUCKET).remove(names);
  if (error) { toast('Gagal hapus semua', 'err'); return; }
  favorites = [];
  localStorage.setItem('favs', '[]');
  await loadPhotos();
  toast('Semua foto dihapus', 'ok');
}

// ‚îÄ‚îÄ FAVORITE ‚îÄ‚îÄ
function toggleFav(name) {
  if (favorites.includes(name)) {
    favorites = favorites.filter(f => f !== name);
    toast('Dihapus dari favorit');
  } else {
    favorites.push(name);
    toast('‚≠ê Ditambah ke favorit', 'ok');
  }
  localStorage.setItem('favs', JSON.stringify(favorites));
  renderGallery();
  renderFavGrid();
}

// ‚îÄ‚îÄ DOWNLOAD ‚îÄ‚îÄ
function downloadPhoto(url, name) {
  const a = document.createElement('a');
  a.href = url; a.download = name; a.target = '_blank';
  a.click();
  toast('‚¨á Mengunduh foto');
}

function downloadAll() {
  if (!photos.length) { toast('Belum ada foto', 'err'); return; }
  toast('Membuka ' + photos.length + ' foto untuk diunduh...');
  photos.slice(0, 5).forEach((p, i) => setTimeout(() => downloadPhoto(p.url, p.name), i * 500));
  if (photos.length > 5) toast('Mengunduh 5 foto pertama. Unduh manual untuk sisanya.', 'err');
}

// ‚îÄ‚îÄ SHARE ‚îÄ‚îÄ
function shareGallery() {
  if (navigator.share) {
    navigator.share({ title: 'In Memory of Bayu', url: window.location.href })
      .then(() => toast('Berhasil dibagikan', 'ok'));
  } else {
    navigator.clipboard?.writeText(window.location.href);
    toast('üîó Link disalin ke clipboard', 'ok');
  }
}

// ‚îÄ‚îÄ LIGHTBOX ‚îÄ‚îÄ
function openLightbox(idx) {
  lightboxIdx = idx;
  const lb = document.getElementById('lightbox');
  lb.classList.add('active');
  renderLightbox();
  document.addEventListener('keydown', lbKeyHandler);
}

function renderLightbox() {
  const p = photos[lightboxIdx];
  if (!p) return;
  document.getElementById('lightboxImg').src = p.url;
  document.getElementById('lbCounter').textContent = `${lightboxIdx + 1}/${photos.length}`;
  renderLbIndicator();
}

function renderLbIndicator() {
  const ind = document.getElementById('lbIndicator');
  const max = Math.min(photos.length, 15);
  ind.innerHTML = Array.from({length: max}, (_, i) => 
    `<div class="lb-dot ${i === (lightboxIdx % max) ? 'active' : ''}" onclick="openLightbox(${i})"></div>`
  ).join('');
}

function lbNav(dir) {
  lightboxIdx = (lightboxIdx + dir + photos.length) % photos.length;
  renderLightbox();
}

function closeLightbox() {
  document.getElementById('lightbox').classList.remove('active');
  document.removeEventListener('keydown', lbKeyHandler);
}

function lbKeyHandler(e) {
  if (e.key === 'ArrowRight') lbNav(1);
  else if (e.key === 'ArrowLeft') lbNav(-1);
  else if (e.key === 'Escape') closeLightbox();
}

function lbDownload() {
  const p = photos[lightboxIdx];
  if (p) downloadPhoto(p.url, p.name);
}

function lbFavorite() {
  const p = photos[lightboxIdx];
  if (p) toggleFav(p.name);
}

function lbDelete() {
  const p = photos[lightboxIdx];
  if (p) deletePhoto(p.name);
}

document.getElementById('lightbox').addEventListener('click', function(e) {
  if (e.target === this) closeLightbox();
});

// ‚îÄ‚îÄ SLIDESHOW ‚îÄ‚îÄ
function gotoPage2(n) { gotoPage(n); }
function startSlideshow() {
  if (!photos.length) { toast('Belum ada foto untuk slideshow', 'err'); return; }
  ssIdx = 0;
  const overlay = document.getElementById('slideshowOverlay');
  overlay.classList.add('active');
  showSsPhoto();
  ssPaused = false;
  ssTimer = setInterval(() => { if (!ssPaused) ssNav(1); }, 3500);
}

function showSsPhoto() {
  const img = document.getElementById('ssImg');
  img.style.opacity = 0;
  setTimeout(() => {
    img.src = photos[ssIdx]?.url || '';
    img.style.opacity = 1;
  }, 300);
}

function ssNav(dir) {
  ssIdx = (ssIdx + dir + photos.length) % photos.length;
  showSsPhoto();
}

function ssPause() {
  ssPaused = !ssPaused;
  document.getElementById('ssPauseBtn').textContent = ssPaused ? '‚ñ∂ Lanjut' : '‚è∏ Pause';
}

function stopSlideshow() {
  clearInterval(ssTimer);
  document.getElementById('slideshowOverlay').classList.remove('active');
}

// ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ
function formatDate(d) {
  if (!d) return '';
  try { return new Date(d).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' }); }
  catch { return ''; }
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
loadPhotos();
</script>
</body>
</html>
