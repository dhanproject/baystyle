<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>In Memory of Bayu</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Lora:ital,wght@0,400;0,600;1,400;1,600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --green:      #22c55e;
  --green-dark: #16a34a;
  --green-pale: #dcfce7;
  --green-bg:   #f0fdf4;
  --black:      #0f172a;
  --gray-900:   #1e293b;
  --gray-700:   #334155;
  --gray-500:   #64748b;
  --gray-300:   #cbd5e1;
  --gray-100:   #f1f5f9;
  --gray-50:    #f8fafc;
  --white:      #ffffff;
  --radius:     16px;
  --shadow-sm:  0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
  --shadow-md:  0 4px 16px rgba(0,0,0,0.08), 0 2px 6px rgba(0,0,0,0.04);
  --shadow-lg:  0 20px 40px rgba(0,0,0,0.1), 0 8px 16px rgba(0,0,0,0.06);
}

html { scroll-behavior: smooth; }

body {
  background: var(--gray-50);
  color: var(--black);
  font-family: 'Plus Jakarta Sans', sans-serif;
  min-height: 100vh;
  overflow-x: hidden;
}

/* ‚îÄ‚îÄ DOT PATTERN BG ‚îÄ‚îÄ */
body::before {
  content: '';
  position: fixed; inset: 0;
  background-image: radial-gradient(circle, #cbd5e1 1px, transparent 1px);
  background-size: 28px 28px;
  opacity: 0.45;
  pointer-events: none; z-index: 0;
}
/* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
nav {
  position: sticky; top: 0; z-index: 100;
  background: rgba(255,255,255,0.85);
  backdrop-filter: blur(16px);
  border-bottom: 1px solid rgba(0,0,0,0.06);
  padding: 0 32px;
  display: flex; align-items: center; justify-content: space-between;
  height: 64px;
}

.nav-logo {
  display: flex; align-items: center; gap: 10px;
}
.nav-logo-icon {
  width: 34px; height: 34px; border-radius: 10px;
  background: linear-gradient(135deg, var(--green), #86efac);
  display: flex; align-items: center; justify-content: center;
  font-size: 1rem; box-shadow: 0 2px 8px rgba(34,197,94,0.3);
}
.nav-logo-text {
  font-size: 0.9rem; font-weight: 700; color: var(--black);
  letter-spacing: -0.02em;
}

.nav-status {
  display: flex; align-items: center; gap: 8px;
  background: var(--gray-100);
  border-radius: 100px;
  padding: 6px 14px;
}
.status-dot {
  width: 7px; height: 7px; border-radius: 50%;
  background: var(--gray-300); transition: all 0.3s;
}
.status-dot.connected { background: var(--green); box-shadow: 0 0 6px rgba(34,197,94,0.5); }
.status-dot.error     { background: #ef4444; box-shadow: 0 0 6px rgba(239,68,68,0.5); }
.status-dot.loading   { background: #f59e0b; animation: blink 1s infinite; }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }
.status-text {
  font-size: 0.7rem; font-weight: 600;
  color: var(--gray-500); letter-spacing: 0.02em;
}

/* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
.hero {
  position: relative; z-index: 10;
  text-align: center;
  padding: 72px 24px 56px;
  max-width: 700px; margin: 0 auto;}

.hero-badge {
  display: inline-flex; align-items: center; gap: 8px;
  background: var(--white);
  border: 1px solid var(--gray-300);
  border-radius: 100px;
  padding: 6px 16px;
  font-size: 0.7rem; font-weight: 600;
  color: var(--gray-500);
  letter-spacing: 0.05em;
  text-transform: uppercase;
  margin-bottom: 24px;
  box-shadow: var(--shadow-sm);
}
.hero-badge-dot {
  width: 6px; height: 6px; border-radius: 50%;
  background: var(--green);
  box-shadow: 0 0 6px rgba(34,197,94,0.6);
}

h1 {
  font-family: 'Lora', serif;
  font-size: clamp(2.4rem, 6vw, 4rem);
  font-weight: 600;
  letter-spacing: -0.03em;
  line-height: 1.15;
  color: var(--black);
  margin-bottom: 16px;
}
h1 .accent {
  color: var(--green-dark);
  font-style: italic;
}

.hero-sub {
  font-size: 1rem; font-weight: 400;
  color: var(--gray-500);
  line-height: 1.6;
  max-width: 480px; margin: 0 auto 36px;
}

.hero-btns {
  display: flex; align-items: center; justify-content: center; gap: 12px;
  flex-wrap: wrap;
}

.btn-primary {
  display: inline-flex; align-items: center; gap: 8px;
  background: var(--black);  color: var(--white);
  padding: 13px 28px;
  border-radius: 100px;
  font-family: 'Plus Jakarta Sans', sans-serif;
  font-size: 0.85rem; font-weight: 700;
  border: none; cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 4px 14px rgba(0,0,0,0.2);
}
.btn-primary:hover { background: var(--gray-900); transform: translateY(-1px); box-shadow: 0 6px 20px rgba(0,0,0,0.25); }
.btn-primary:active { transform: translateY(0); }

.btn-secondary {
  display: inline-flex; align-items: center; gap: 8px;
  background: var(--white);
  color: var(--gray-700);
  padding: 12px 24px;
  border-radius: 100px;
  font-family: 'Plus Jakarta Sans', sans-serif;
  font-size: 0.85rem; font-weight: 600;
  border: 1px solid var(--gray-300); cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: var(--shadow-sm);
}
.btn-secondary:hover { border-color: var(--gray-500); transform: translateY(-1px); }

#fileInput { display: none; }

/* ‚îÄ‚îÄ UPLOAD ZONE ‚îÄ‚îÄ */
.upload-zone {
  position: relative; z-index: 10;
  max-width: 680px; margin: 0 auto 48px;
  padding: 0 24px;
}

.drop-area {
  background: var(--white);
  border: 2px dashed var(--gray-300);
  border-radius: 20px;
  padding: 40px 32px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: var(--shadow-sm);
}
.drop-area:hover, .drop-area.drag-over {
  border-color: var(--green);
  background: var(--green-bg);
  box-shadow: 0 0 0 4px rgba(34,197,94,0.08);
}
.drop-icon {
  width: 60px; height: 60px; border-radius: 16px;
  background: var(--gray-100);
  display: inline-flex; align-items: center; justify-content: center;
  margin-bottom: 16px;
  transition: all 0.3s ease;
}
.drop-area:hover .drop-icon, .drop-area.drag-over .drop-icon {
  background: var(--green-pale);
}
.drop-icon svg { width: 28px; height: 28px; stroke: var(--gray-500); transition: stroke 0.3s; }
.drop-area:hover .drop-icon svg, .drop-area.drag-over .drop-icon svg { stroke: var(--green-dark); }

.drop-title {
  font-size: 1rem; font-weight: 700; color: var(--black); margin-bottom: 4px;
}
.drop-sub {
  font-size: 0.8rem; color: var(--gray-500); margin-bottom: 20px;
}

.upload-progress { margin-top: 20px; display: none; }
.progress-track {
  width: 100%; height: 4px; background: var(--gray-100); border-radius: 100px; overflow: hidden; margin-bottom: 8px;
}
.progress-fill {
  height: 100%; background: linear-gradient(90deg, var(--green-dark), var(--green));
  border-radius: 100px; width: 0%; transition: width 0.3s ease;
}
.progress-label { font-size: 0.72rem; font-weight: 600; color: var(--gray-500); }

/* ‚îÄ‚îÄ GALLERY HEADER ‚îÄ‚îÄ */
.gallery-header {
  position: relative; z-index: 10;
  max-width: 1200px; margin: 0 auto;
  padding: 0 32px 20px;
  display: flex; align-items: center; justify-content: space-between;
  flex-wrap: wrap; gap: 12px;
}

.gallery-title-wrap { display: flex; align-items: center; gap: 10px; }
.gallery-title-wrap h2 {
  font-size: 1rem; font-weight: 800; color: var(--black); letter-spacing: -0.02em;
}
.count-pill {
  background: var(--green);
  color: var(--white);
  font-size: 0.65rem; font-weight: 800;
  padding: 3px 10px; border-radius: 100px;
  min-width: 26px; text-align: center;}

.gallery-actions { display: flex; align-items: center; gap: 8px; }

.layout-toggle {
  display: flex; background: var(--white); border: 1px solid var(--gray-200);
  border-radius: 10px; padding: 3px; gap: 2px;
  box-shadow: var(--shadow-sm);
}
.lt-btn {
  background: transparent; border: none;
  color: var(--gray-400);
  width: 30px; height: 30px; border-radius: 7px;
  font-size: 0.7rem; font-weight: 800;
  cursor: pointer; transition: all 0.2s;
  display: flex; align-items: center; justify-content: center;
}
.lt-btn.active { background: var(--black); color: var(--white); }
.lt-btn:hover:not(.active) { background: var(--gray-100); color: var(--black); }

.btn-clear-all {
  background: transparent;
  border: 1px solid var(--gray-200);
  color: var(--gray-500);
  padding: 6px 14px; border-radius: 8px;
  font-family: 'Plus Jakarta Sans', sans-serif;
  font-size: 0.7rem; font-weight: 600;
  cursor: pointer; transition: all 0.2s;
}
.btn-clear-all:hover { border-color: #ef4444; color: #ef4444; background: #fff1f2; }

/* ‚îÄ‚îÄ GALLERY GRID ‚îÄ‚îÄ */
#gallery {
  position: relative; z-index: 10;
  max-width: 1200px; margin: 0 auto;
  padding: 0 32px 80px;
  columns: 3; column-gap: 16px;
}
#gallery.layout-2 { columns: 2; }
#gallery.layout-4 { columns: 4; }

@media (max-width: 960px) {
  #gallery { columns: 2 !important; padding: 0 20px 60px; }
  .gallery-header { padding: 0 20px 20px; }
  nav { padding: 0 20px; }
}
@media (max-width: 560px) {
  #gallery { columns: 1 !important; }
  .hero { padding: 48px 20px 40px; }
  h1 { font-size: 2.2rem; }}

/* Photo card */
.photo-item {
  break-inside: avoid; margin-bottom: 16px;
  position: relative; border-radius: 14px; overflow: hidden;
  cursor: pointer; box-shadow: var(--shadow-sm);
  animation: fadeUp 0.5s ease both;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  background: var(--white);
}
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(16px); }
  to   { opacity: 1; transform: translateY(0); }
}
.photo-item:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); }
.photo-item img {
  width: 100%; height: auto; display: block;
  transition: transform 0.5s ease;
}
.photo-item:hover img { transform: scale(1.04); }

.photo-overlay {
  position: absolute; inset: 0;
  background: linear-gradient(to top, rgba(0,0,0,0.65) 0%, transparent 50%);
  opacity: 0; transition: opacity 0.3s;
  display: flex; align-items: flex-end; padding: 14px;
}
.photo-item:hover .photo-overlay { opacity: 1; }

.photo-btns { display: flex; gap: 6px; width: 100%; justify-content: flex-end; }
.photo-btn {
  background: rgba(255,255,255,0.15);
  border: 1px solid rgba(255,255,255,0.25);
  color: white; padding: 5px 14px;
  border-radius: 100px;
  font-family: 'Plus Jakarta Sans', sans-serif;
  font-size: 0.65rem; font-weight: 700;
  letter-spacing: 0.03em; cursor: pointer;
  transition: all 0.2s; backdrop-filter: blur(8px);
}
.photo-btn:hover { background: rgba(255,255,255,0.9); color: var(--black); }
.photo-btn.del:hover { background: #ef4444; border-color: #ef4444; color: white; }

/* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
#emptyState {
  break-inside: avoid;
  grid-column: 1 / -1;
  text-align: center; padding: 80px 20px;
  display: flex; flex-direction: column; align-items: center;}
.empty-icon-wrap {
  width: 80px; height: 80px; border-radius: 24px;
  background: var(--white);
  border: 2px dashed var(--gray-300);
  display: flex; align-items: center; justify-content: center;
  font-size: 2rem; margin: 0 auto 20px;
  animation: floatIcon 3s ease-in-out infinite;
}
@keyframes floatIcon { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-8px)} }
.empty-h { font-size: 1.2rem; font-weight: 800; color: var(--black); margin-bottom: 6px; }
.empty-p { font-size: 0.85rem; color: var(--gray-500); }

/* ‚îÄ‚îÄ LIGHTBOX ‚îÄ‚îÄ */
#lightbox {
  position: fixed; inset: 0;
  background: rgba(15,23,42,0.95);
  z-index: 10000; display: none;
  align-items: center; justify-content: center;
  backdrop-filter: blur(20px);
}
#lightbox.active { display: flex; }

.lb-wrap {
  position: relative;
  animation: lbIn 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
}
@keyframes lbIn { from{opacity:0;transform:scale(0.9)} to{opacity:1;transform:scale(1)} }

#lightboxImg {
  max-width: 88vw; max-height: 82vh;
  object-fit: contain; display: block;
  border-radius: 16px;
  box-shadow: 0 40px 80px rgba(0,0,0,0.5);
}

.lb-bar {
  display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 18px;
}
.lb-btn {
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.15);
  color: white; padding: 8px 20px; border-radius: 100px;
  font-family: 'Plus Jakarta Sans', sans-serif;
  font-size: 0.72rem; font-weight: 700;
  cursor: pointer; transition: all 0.2s; backdrop-filter: blur(8px);
}
.lb-btn:hover { background: rgba(255,255,255,0.2); }
.lb-btn.danger:hover { background: #ef4444; border-color: #ef4444; }
.lb-close {  position: fixed; top: 24px; right: 24px;
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.15);
  color: white; width: 42px; height: 42px; border-radius: 50%;
  font-size: 1rem; cursor: pointer; transition: all 0.2s;
  display: flex; align-items: center; justify-content: center;
  backdrop-filter: blur(8px);
}
.lb-close:hover { background: rgba(255,255,255,0.2); }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
#toast {
  position: fixed; bottom: 28px; left: 50%;
  transform: translateX(-50%) translateY(70px);
  background: var(--black); color: var(--white);
  padding: 12px 24px; border-radius: 100px;
  font-size: 0.78rem; font-weight: 600;
  z-index: 20000; transition: transform 0.35s ease, opacity 0.35s;
  opacity: 0; pointer-events: none; white-space: nowrap;
  box-shadow: 0 8px 24px rgba(0,0,0,0.25);
  display: flex; align-items: center; gap: 8px;
}
#toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
#toast.err  { background: #ef4444; }
#toast.ok   { background: var(--green-dark); }

/* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
footer {
  position: relative; z-index: 10;
  text-align: center; padding: 32px 20px 48px;
  border-top: 1px solid var(--gray-200);
}
footer p {
  font-size: 0.75rem; color: var(--gray-400); font-weight: 500;
}
footer span { color: var(--green-dark); font-weight: 700; }

/* Gray border for gallery */
.gray-200 { border-color: #e2e8f0; }

::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--gray-50); }
::-webkit-scrollbar-thumb { background: var(--gray-300); border-radius: 3px; }
::selection { background: var(--green-pale); color: var(--green-dark); }
</style>
</head>
<body>

<!-- NAV -->
<nav>  <div class="nav-logo">
    <div class="nav-logo-icon">üåø</div>
    <span class="nav-logo-text">In Memory of Bayu</span>
  </div>
  <div class="nav-status">
    <div class="status-dot loading" id="statusDot"></div>
    <span class="status-text" id="statusText">Memuat...</span>
  </div>
</nav>

<!-- HERO -->
<section class="hero">
  <div class="hero-badge">
    <div class="hero-badge-dot"></div>
    Galeri Foto ¬∑ Kenangan Abadi
  </div>
  <h1>In Memory of<br><span class="accent">Bayu</span></h1>
  <p class="hero-sub">Kumpulkan, simpan, dan abadikan setiap momen bersama. Foto tersimpan permanen di cloud.</p>
  <div class="hero-btns">
    <label for="fileInput" class="btn-primary">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
      Upload Foto
    </label>
    <button class="btn-secondary" onclick="document.getElementById('gallery').scrollIntoView({behavior:'smooth'})">
      <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
      Lihat Galeri
    </button>
  </div>
  <input type="file" id="fileInput" multiple accept="image/*">
</section>

<!-- UPLOAD ZONE -->
<div class="upload-zone">
  <div class="drop-area" id="dropArea">
    <div class="drop-icon">
      <svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
        <polyline points="17 8 12 3 7 8"/>
        <line x1="12" y1="3" x2="12" y2="15"/>
      </svg>
    </div>
    <div class="drop-title">Seret & lepas foto di sini</div>
    <div class="drop-sub">JPG, PNG, WEBP ¬∑ Bisa banyak sekaligus</div>
    <label for="fileInput2" class="btn-primary" style="font-size:0.78rem; padding:10px 22px;">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      Pilih Foto
    </label>
    <input type="file" id="fileInput2" multiple accept="image/*" style="display:none">
    <div class="upload-progress" id="uploadProgress">
      <div class="progress-track"><div class="progress-fill" id="progressFill"></div></div>      <div class="progress-label" id="progressLabel">Mengunggah...</div>
    </div>
  </div>
</div>

<!-- GALLERY HEADER -->
<div class="gallery-header" id="galleryHeader">
  <div class="gallery-title-wrap">
    <h2>Semua Foto</h2>
    <span class="count-pill" id="photoCount">0</span>
  </div>
  <div class="gallery-actions" id="galleryControls" style="display:none">
    <div class="layout-toggle">
      <button class="lt-btn" onclick="setLayout(2)">2</button>
      <button class="lt-btn active" onclick="setLayout(3)">3</button>
      <button class="lt-btn" onclick="setLayout(4)">4</button>
    </div>
    <button class="btn-clear-all" onclick="clearAll()">Hapus Semua</button>
  </div>
</div>

<!-- GALLERY -->
<div id="gallery">
  <div id="emptyState">
    <div class="empty-icon-wrap">üñºÔ∏è</div>
    <div class="empty-h">Belum ada foto</div>
    <div class="empty-p">Upload foto pertama untuk memulai kenangan</div>
  </div>
</div>

<!-- LIGHTBOX -->
<div id="lightbox">
  <button class="lb-close" onclick="closeLightbox()">‚úï</button>
  <div class="lb-wrap">
    <img id="lightboxImg" src="" alt="">
    <div class="lb-bar">
      <button class="lb-btn" id="lbPrev">‚Üê Sebelumnya</button>
      <button class="lb-btn danger" id="lbDel">Hapus</button>
      <button class="lb-btn" id="lbNext">Berikutnya ‚Üí</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="toast"></div>

<!-- FOOTER -->
<footer>
  <p>Dibuat dengan ü•∂ untuk mengenang <span>Bayu</span> ¬∑ Foto tersimpan aman di cloud</p>
</footer>
<script>
  // ‚îÄ‚îÄ SUPABASE CONFIG ‚îÄ‚îÄ
  const SUPABASE_URL = 'https://olkokmuburmgslpsiwpi.supabase.co';
  // Perbaikan: Hapus prefix 'sb_publishable_' karena itu bukan bagian dari key
  const SUPABASE_KEY = 'FHgCHk8ocJPkEGWUiejlCA_BHRcN17v'; 
  const BUCKET       = 'images';

  const { createClient } = supabase;
  const sb = createClient(SUPABASE_URL, SUPABASE_KEY);

  // ‚îÄ‚îÄ ELEMENTS ‚îÄ‚îÄ
  const fileInput       = document.getElementById('fileInput');
  const fileInput2      = document.getElementById('fileInput2');
  const dropArea        = document.getElementById('dropArea');
  const gallery         = document.getElementById('gallery');
  const emptyState      = document.getElementById('emptyState');
  const photoCountEl    = document.getElementById('photoCount');
  const galleryControls = document.getElementById('galleryControls');
  const lightbox        = document.getElementById('lightbox');
  const lightboxImg     = document.getElementById('lightboxImg');
  const statusDot       = document.getElementById('statusDot');
  const statusText      = document.getElementById('statusText');
  const uploadProgress  = document.getElementById('uploadProgress');
  const progressFill    = document.getElementById('progressFill');
  const progressLabel   = document.getElementById('progressLabel');
  const toastEl         = document.getElementById('toast');

  let photos     = [];
  let currentIdx = 0;
  let toastTimer = null;

  // ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ
  function showToast(msg, type = '') {
    clearTimeout(toastTimer);
    toastEl.textContent = msg;
    toastEl.className   = 'show ' + type;
    toastTimer = setTimeout(() => { toastEl.className = ''; }, 3200);
  }

  function setStatus(state, text) {
    statusDot.className  = 'status-dot ' + state;
    statusText.textContent = text;
  }

  // ‚îÄ‚îÄ LOAD PHOTOS ‚îÄ‚îÄ
  async function loadPhotos() {
    setStatus('loading', 'Memuat...');
    try {
      // Mengambil daftar file dari bucket      const { data, error } = await sb.storage.from(BUCKET).list('', {
        limit: 500,
        offset: 0,
        sortBy: { column: 'created_at', order: 'desc' },
      });

      if (error) throw error;

      photos = data.map(file => ({
        name: file.name,
        url: sb.storage.from(BUCKET).getPublicUrl(file.name).data.publicUrl,
        created_at: file.created_at
      }));

      renderGallery();
      setStatus('connected', 'Online');
    } catch (err) {
      console.error('Error loading photos:', err);
      setStatus('error', 'Gagal Memuat');
      showToast('Gagal mengambil foto dari server', 'err');
    }
  }

  // ‚îÄ‚îÄ UPLOAD FUNCTION ‚îÄ‚îÄ
  async function uploadFiles(files) {
    if (!files || files.length === 0) return;

    uploadProgress.style.display = 'block';
    progressFill.style.width = '0%';
    
    let uploadedCount = 0;
    const totalFiles = files.length;

    for (let i = 0; i < files.length; i++) {
      const file = files[i];
      
      // Validasi tipe file
      if (!file.type.startsWith('image/')) {
        showToast(`${file.name} bukan gambar`, 'err');
        continue;
      }

      // Generate nama unik untuk menghindari duplikat
      const fileExt = file.name.split('.').pop();
      const fileName = `${Date.now()}_${Math.random().toString(36).substring(2)}.${fileExt}`;

      try {
        const { data, error } = await sb.storage
          .from(BUCKET)
          .upload(fileName, file, {            cacheControl: '3600',
            upsert: false
          });

        if (error) throw error;

        uploadedCount++;
        const percent = Math.round((uploadedCount / totalFiles) * 100);
        progressFill.style.width = `${percent}%`;
        progressLabel.textContent = `Mengunggah ${uploadedCount}/${totalFiles}...`;

      } catch (err) {
        console.error('Upload error:', err);
        showToast(`Gagal upload ${file.name}`, 'err');
      }
    }

    uploadProgress.style.display = 'none';
    progressFill.style.width = '0%';
    
    if (uploadedCount > 0) {
      showToast(`${uploadedCount} foto berhasil diupload`, 'ok');
      await loadPhotos(); // Reload galeri
    }
  }

  // ‚îÄ‚îÄ RENDER GALLERY ‚îÄ‚îÄ
  function renderGallery() {
    gallery.innerHTML = '';
    photoCountEl.textContent = photos.length;

    if (photos.length === 0) {
      gallery.appendChild(emptyState);
      galleryControls.style.display = 'none';
      return;
    }

    galleryControls.style.display = 'flex';

    photos.forEach((photo, index) => {
      const item = document.createElement('div');
      item.className = 'photo-item';
      item.onclick = (e) => {
        if (!e.target.closest('.photo-btn')) openLightbox(index);
      };

      item.innerHTML = `
        <img src="${photo.url}" alt="${photo.name}" loading="lazy">
        <div class="photo-overlay">
          <div class="photo-btns">            <button class="photo-btn del" onclick="deletePhoto('${photo.name}', event)">Hapus</button>
          </div>
        </div>
      `;
      gallery.appendChild(item);
    });
  }

  // ‚îÄ‚îÄ DELETE PHOTO ‚îÄ‚îÄ
  async function deletePhoto(fileName, event) {
    event.stopPropagation();
    if (!confirm('Yakin ingin menghapus foto ini?')) return;

    try {
      const { error } = await sb.storage.from(BUCKET).remove([fileName]);
      if (error) throw error;
      
      showToast('Foto berhasil dihapus', 'ok');
      await loadPhotos();
    } catch (err) {
      console.error('Delete error:', err);
      showToast('Gagal menghapus foto', 'err');
    }
  }

  // ‚îÄ‚îÄ CLEAR ALL ‚îÄ‚îÄ
  async function clearAll() {
    if (!confirm('PERINGATAN: Ini akan menghapus SEMUA foto. Lanjutkan?')) return;

    const fileNames = photos.map(p => p.name);
    try {
      const { error } = await sb.storage.from(BUCKET).remove(fileNames);
      if (error) throw error;
      
      showToast('Semua foto dihapus', 'ok');
      await loadPhotos();
    } catch (err) {
      console.error('Clear all error:', err);
      showToast('Gagal menghapus semua foto', 'err');
    }
  }

  // ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ
  function setLayout(cols) {
    gallery.className = '';
    if (cols !== 3) gallery.classList.add(`layout-${cols}`);
    
    document.querySelectorAll('.lt-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
  }
  // ‚îÄ‚îÄ LIGHTBOX ‚îÄ‚îÄ
  function openLightbox(index) {
    currentIdx = index;
    lightboxImg.src = photos[index].url;
    lightbox.classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  function closeLightbox() {
    lightbox.classList.remove('active');
    document.body.style.overflow = '';
  }

  document.getElementById('lbNext').onclick = () => {
    currentIdx = (currentIdx + 1) % photos.length;
    lightboxImg.src = photos[currentIdx].url;
  };

  document.getElementById('lbPrev').onclick = () => {
    currentIdx = (currentIdx - 1 + photos.length) % photos.length;
    lightboxImg.src = photos[currentIdx].url;
  };

  document.getElementById('lbDel').onclick = () => {
    deletePhoto(photos[currentIdx].name, { stopPropagation: () => {} });
    closeLightbox();
  };

  lightbox.onclick = (e) => {
    if (e.target === lightbox) closeLightbox();
  };

  // ‚îÄ‚îÄ EVENT LISTENERS ‚îÄ‚îÄ
  fileInput.addEventListener('change', (e) => uploadFiles(e.target.files));
  fileInput2.addEventListener('change', (e) => uploadFiles(e.target.files));

  // Drag & Drop
  ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    dropArea.addEventListener(eventName, preventDefaults, false);
  });

  function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
  }

  ['dragenter', 'dragover'].forEach(eventName => {
    dropArea.addEventListener(eventName, () => dropArea.classList.add('drag-over'), false);
  });
  ['dragleave', 'drop'].forEach(eventName => {
    dropArea.addEventListener(eventName, () => dropArea.classList.remove('drag-over'), false);
  });

  dropArea.addEventListener('drop', (e) => {
    const dt = e.dataTransfer;
    const files = dt.files;
    uploadFiles(files);
  });

  // Init
  loadPhotos();

</script>
</body>
</html>
