<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>In Memory of Bayu</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}

:root{
  --accent:#4361ee;
  --accent2:#7c3aed;
  --accent-light:#eef2ff;
  --green:#22c55e;
  --orange:#f97316;
  --pink:#ec4899;
  --teal:#14b8a6;
  --bg:#f0f2f8;
  --card:#ffffff;
  --text:#1a1d2e;
  --text2:#6b7280;
  --text3:#b0b7c3;
  --border:#e4e7f0;
  --radius:22px;
  --radius-sm:14px;
  --sh:0 2px 20px rgba(67,97,238,0.08),0 1px 4px rgba(0,0,0,0.04);
  --sh-md:0 8px 40px rgba(67,97,238,0.13),0 2px 10px rgba(0,0,0,0.06);
  --sh-lg:0 24px 64px rgba(67,97,238,0.18),0 8px 24px rgba(0,0,0,0.08);
  --spring:cubic-bezier(0.34,1.56,0.64,1);
  --ease:cubic-bezier(0.4,0,0.2,1);
  --ease-out:cubic-bezier(0,0,0.2,1);
}
[data-theme="dark"]{
  --accent:#6d83f2;
  --accent-light:#1e2240;
  --bg:#0f1120;
  --card:#181b2e;
  --text:#f0f4ff;
  --text2:#8892b0;
  --text3:#4a5270;
  --border:#252840;
  --sh:0 2px 20px rgba(0,0,0,0.4);
  --sh-md:0 8px 40px rgba(0,0,0,0.5);
  --sh-lg:0 24px 64px rgba(0,0,0,0.6);
}

html{scroll-behavior:smooth;}
body{
  font-family:'DM Sans',sans-serif;
  background:var(--bg);color:var(--text);
  min-height:100vh;overflow-x:hidden;
  transition:background 0.4s var(--ease),color 0.4s var(--ease);
  -webkit-font-smoothing:antialiased;
}

.app-shell{max-width:430px;margin:0 auto;min-height:100vh;position:relative;overflow:hidden;}

/* ‚îÄ‚îÄ PAGES: smooth fade+slide transition ‚îÄ‚îÄ */
.page{
  position:absolute;inset:0;
  overflow-y:auto;overflow-x:hidden;
  padding-bottom:88px;
  opacity:0;
  transform:translateY(16px);
  pointer-events:none;
  transition:opacity 0.38s var(--ease-out),transform 0.38s var(--ease-out);
  will-change:transform,opacity;
  background:var(--bg);
  -webkit-overflow-scrolling:touch;
}
.page.active{opacity:1;transform:translateY(0);pointer-events:auto;}

/* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
.topbar{
  display:flex;align-items:center;justify-content:space-between;
  padding:54px 22px 14px;
  position:sticky;top:0;z-index:40;
  background:var(--bg);
  transition:background 0.35s var(--ease),box-shadow 0.3s var(--ease),backdrop-filter 0.35s;
}
.topbar.scrolled{
  background:rgba(240,242,248,0.85);
  backdrop-filter:blur(22px) saturate(1.6);
  box-shadow:0 1px 0 var(--border);
}
[data-theme="dark"] .topbar.scrolled{background:rgba(15,17,32,0.88);}
.topbar-left{display:flex;align-items:center;gap:12px;}
.avatar{
  width:42px;height:42px;border-radius:50%;
  background:linear-gradient(135deg,var(--accent),var(--pink));
  display:flex;align-items:center;justify-content:center;
  font-size:1.2rem;font-weight:700;color:#fff;
  box-shadow:0 3px 12px rgba(67,97,238,0.3);
  flex-shrink:0;overflow:hidden;cursor:pointer;
  transition:transform 0.35s var(--spring),box-shadow 0.25s;
  will-change:transform;
}
.avatar:active{transform:scale(0.88);}
.avatar img{width:100%;height:100%;object-fit:cover;}
.topbar-greeting h1{font-family:'DM Serif Display',serif;font-size:1.3rem;font-weight:400;color:var(--text);line-height:1.2;}
.topbar-greeting p{font-size:0.75rem;color:var(--text2);margin-top:1px;}
.topbar-actions{display:flex;align-items:center;gap:8px;}
.icon-btn{
  width:38px;height:38px;border-radius:50%;
  background:var(--card);border:1.5px solid var(--border);color:var(--text);
  display:flex;align-items:center;justify-content:center;
  font-size:1rem;cursor:pointer;box-shadow:var(--sh);
  transition:transform 0.35s var(--spring),background 0.25s var(--ease),border-color 0.25s,box-shadow 0.25s;
  will-change:transform;
}
.icon-btn:hover{background:var(--accent);color:#fff;border-color:var(--accent);transform:scale(1.1);box-shadow:0 6px 20px rgba(67,97,238,0.35);}
.icon-btn:active{transform:scale(0.88);}
.icon-btn.primary{background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 4px 16px rgba(67,97,238,0.4);}

/* ‚îÄ‚îÄ STATS ‚îÄ‚îÄ */
.stats-bar{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:0 22px 20px;}
.stat-card{
  background:var(--card);border-radius:var(--radius-sm);padding:14px 10px;
  box-shadow:var(--sh);text-align:center;border:1px solid var(--border);
  transition:transform 0.4s var(--spring),box-shadow 0.3s var(--ease);
  will-change:transform;cursor:default;
}
.stat-card:hover{transform:translateY(-5px) scale(1.03);box-shadow:var(--sh-md);}
.stat-icon{font-size:1.25rem;margin-bottom:5px;display:block;transition:transform 0.4s var(--spring);}
.stat-card:hover .stat-icon{transform:scale(1.22) rotate(-6deg);}
.stat-num{font-size:1.15rem;font-weight:700;color:var(--text);line-height:1;}
.stat-label{font-size:0.6rem;color:var(--text2);margin-top:3px;font-weight:600;text-transform:uppercase;letter-spacing:0.05em;}

/* ‚îÄ‚îÄ SECTION HEADER ‚îÄ‚îÄ */
.section-header{display:flex;align-items:center;justify-content:space-between;padding:0 22px 10px;}
.section-title{font-size:0.95rem;font-weight:700;color:var(--text);}
.section-link{
  font-size:0.7rem;font-weight:600;color:var(--accent);cursor:pointer;
  background:var(--accent-light);padding:5px 13px;border-radius:100px;border:none;font-family:inherit;
  transition:background 0.25s,color 0.25s,transform 0.35s var(--spring);
  will-change:transform;
}
.section-link:hover{background:var(--accent);color:#fff;transform:scale(1.05);}
.section-link:active{transform:scale(0.93);}

/* ‚îÄ‚îÄ TRIBUTE ‚îÄ‚îÄ */
.tribute-card{
  margin:0 22px 20px;
  background:linear-gradient(135deg,#1a1d2e 0%,#2d1b69 100%);
  border-radius:var(--radius);padding:22px;color:#fff;
  position:relative;overflow:hidden;
  box-shadow:0 10px 40px rgba(45,27,105,0.35);
  transition:transform 0.42s var(--spring),box-shadow 0.3s var(--ease);
  will-change:transform;
}
.tribute-card:hover{transform:translateY(-5px) scale(1.01);box-shadow:0 20px 60px rgba(45,27,105,0.5);}
.tribute-card::before{content:'‚ú¶';position:absolute;top:14px;right:18px;font-size:2.5rem;opacity:0.12;animation:starFloat 4s ease-in-out infinite;}
@keyframes starFloat{0%,100%{transform:translateY(0) rotate(0deg);}50%{transform:translateY(-7px) rotate(12deg);}}
.tribute-card h3{font-family:'DM Serif Display',serif;font-size:1.15rem;font-weight:400;margin-bottom:8px;}
.tribute-card p{font-size:0.75rem;opacity:0.72;line-height:1.65;}
.tribute-years{font-size:0.6rem;margin-top:12px;opacity:0.45;font-weight:600;letter-spacing:0.1em;text-transform:uppercase;}

/* ‚îÄ‚îÄ FEATURE SCROLL ‚îÄ‚îÄ */
.feature-scroll{display:flex;gap:12px;padding:0 22px 20px;overflow-x:auto;scrollbar-width:none;-webkit-overflow-scrolling:touch;}
.feature-scroll::-webkit-scrollbar{display:none;}
.feature-card{
  flex-shrink:0;width:200px;height:130px;border-radius:var(--radius);
  overflow:hidden;position:relative;cursor:pointer;
  box-shadow:var(--sh-md);
  transition:transform 0.42s var(--spring),box-shadow 0.3s var(--ease);
  will-change:transform;
}
.feature-card:hover{transform:scale(1.05) translateY(-5px);box-shadow:var(--sh-lg);}
.feature-card:active{transform:scale(0.96);}
.feature-card img{width:100%;height:100%;object-fit:cover;transition:transform 0.65s var(--ease);}
.feature-card:hover img{transform:scale(1.1);}
.feature-card-overlay{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,0.72) 0%,transparent 55%);}
.feature-card-label{position:absolute;bottom:10px;left:12px;color:#fff;font-size:0.72rem;font-weight:600;display:flex;align-items:center;gap:6px;}
.live-dot{
  width:7px;height:7px;border-radius:50%;
  background:var(--green);
  animation:livePulse 2s infinite;
}
@keyframes livePulse{0%{box-shadow:0 0 0 0 rgba(34,197,94,0.5);}70%{box-shadow:0 0 0 6px rgba(34,197,94,0);}100%{box-shadow:0 0 0 0 rgba(34,197,94,0);}}
.feature-card-add{
  flex-shrink:0;width:130px;height:130px;border-radius:var(--radius);
  border:2px dashed var(--border);display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:6px;cursor:pointer;background:var(--card);
  transition:border-color 0.3s,background 0.3s,transform 0.42s var(--spring);
  will-change:transform;
}
.feature-card-add:hover{border-color:var(--accent);background:var(--accent-light);transform:scale(1.06);}
.feature-card-add:active{transform:scale(0.93);}
.feature-card-add span{font-size:1.6rem;transition:transform 0.4s var(--spring);}
.feature-card-add:hover span{transform:scale(1.25) rotate(12deg);}
.feature-card-add p{font-size:0.67rem;color:var(--text2);font-weight:600;}

/* ‚îÄ‚îÄ ROOM TABS ‚îÄ‚îÄ */
.room-tabs{display:flex;gap:8px;padding:0 22px 16px;overflow-x:auto;scrollbar-width:none;}
.room-tabs::-webkit-scrollbar{display:none;}
.room-tab{
  flex-shrink:0;padding:8px 18px;border-radius:100px;
  font-size:0.76rem;font-weight:600;
  border:1.5px solid var(--border);background:var(--card);color:var(--text2);
  cursor:pointer;font-family:inherit;white-space:nowrap;
  transition:background 0.28s,color 0.28s,border-color 0.28s,transform 0.38s var(--spring),box-shadow 0.28s;
  will-change:transform;
}
.room-tab.active{background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 5px 18px rgba(67,97,238,0.35);transform:translateY(-2px);}
.room-tab:hover:not(.active){border-color:var(--accent);color:var(--accent);transform:translateY(-2px);}
.room-tab:active{transform:scale(0.93) translateY(0);}

/* ‚îÄ‚îÄ DEVICE GRID ‚îÄ‚îÄ */
.device-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:0 22px 20px;}
.device-card{
  background:var(--card);border-radius:var(--radius-sm);padding:14px 12px;
  box-shadow:var(--sh);border:1px solid var(--border);
  cursor:pointer;display:flex;flex-direction:column;gap:5px;
  transition:transform 0.42s var(--spring),box-shadow 0.3s var(--ease),background 0.3s;
  will-change:transform;
}
.device-card:hover{transform:translateY(-6px) scale(1.03);box-shadow:var(--sh-md);}
.device-card:active{transform:scale(0.92) translateY(0);}
.device-card.on{border-color:transparent;}
.device-card.on.blue{background:linear-gradient(135deg,var(--accent),#7c8ff5);color:#fff;}
.device-card.on.orange{background:linear-gradient(135deg,var(--orange),#fbbf24);color:#fff;}
.device-card.on.teal{background:linear-gradient(135deg,var(--teal),#34d399);color:#fff;}
.device-card.on.pink{background:linear-gradient(135deg,var(--pink),#f472b6);color:#fff;}
.device-icon{font-size:1.3rem;transition:transform 0.42s var(--spring);}
.device-card:hover .device-icon{transform:scale(1.3) rotate(-10deg);}
.device-name{font-size:0.7rem;font-weight:700;}
.device-val{font-size:0.6rem;opacity:0.72;}
.device-toggle{
  align-self:flex-end;width:28px;height:16px;border-radius:100px;
  background:rgba(255,255,255,0.25);position:relative;cursor:pointer;
  transition:background 0.3s var(--ease);
}
.device-toggle::after{
  content:'';position:absolute;top:2px;left:2px;width:12px;height:12px;
  border-radius:50%;background:#fff;box-shadow:0 1px 4px rgba(0,0,0,0.2);
  transition:left 0.3s var(--spring);
}
.device-toggle.on::after{left:14px;}
.device-toggle.off{background:var(--border);}
.device-toggle.off::after{background:var(--text3);}

/* ‚îÄ‚îÄ UPLOAD ‚îÄ‚îÄ */
.upload-area{
  margin:0 22px 18px;border:2px dashed var(--border);border-radius:var(--radius);
  padding:26px 20px;text-align:center;cursor:pointer;background:var(--card);
  transition:border-color 0.3s,background 0.3s,transform 0.38s var(--spring),box-shadow 0.3s;
  will-change:transform;
}
.upload-area:hover,.upload-area.drag-over{border-color:var(--accent);background:var(--accent-light);transform:scale(1.01);box-shadow:0 0 0 4px rgba(67,97,238,0.1);}
.upload-icon{font-size:2rem;margin-bottom:8px;display:block;transition:transform 0.42s var(--spring);}
.upload-area:hover .upload-icon{transform:translateY(-7px) scale(1.12);}
.upload-title{font-size:0.85rem;font-weight:700;color:var(--text);margin-bottom:4px;}
.upload-sub{font-size:0.7rem;color:var(--text2);margin-bottom:14px;}
.upload-btn{
  display:inline-flex;align-items:center;gap:6px;
  background:var(--accent);color:#fff;padding:9px 22px;border-radius:100px;
  font-size:0.75rem;font-weight:700;border:none;cursor:pointer;font-family:inherit;
  box-shadow:0 4px 16px rgba(67,97,238,0.35);
  transition:background 0.25s,transform 0.38s var(--spring),box-shadow 0.25s;
  will-change:transform;
}
.upload-btn:hover{background:var(--accent2);transform:translateY(-2px) scale(1.04);box-shadow:0 8px 24px rgba(67,97,238,0.45);}
.upload-btn:active{transform:scale(0.93);}
.progress-wrap{margin-top:14px;display:none;}
.progress-bar{height:5px;background:var(--border);border-radius:100px;overflow:hidden;}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--teal));border-radius:100px;width:0%;transition:width 0.4s var(--ease);}
.progress-label{font-size:0.68rem;color:var(--text2);margin-top:6px;font-weight:600;}

/* ‚îÄ‚îÄ SEARCH ‚îÄ‚îÄ */
.search-bar{
  margin:0 22px 14px;background:var(--card);border:1.5px solid var(--border);
  border-radius:100px;display:flex;align-items:center;gap:10px;padding:10px 16px;
  box-shadow:var(--sh);
  transition:border-color 0.25s,box-shadow 0.25s;
}
.search-bar:focus-within{border-color:var(--accent);box-shadow:0 0 0 3px rgba(67,97,238,0.12),var(--sh);}
.search-bar span{font-size:1rem;color:var(--text2);}
.search-bar input{border:none;background:transparent;font-family:inherit;font-size:0.82rem;color:var(--text);flex:1;outline:none;}
.search-bar input::placeholder{color:var(--text3);}

/* ‚îÄ‚îÄ FILTER PILLS ‚îÄ‚îÄ */
.filter-pills{display:flex;gap:6px;padding:0 22px 14px;overflow-x:auto;scrollbar-width:none;}
.filter-pills::-webkit-scrollbar{display:none;}
.filter-pill{
  flex-shrink:0;padding:6px 14px;border-radius:100px;font-size:0.69rem;font-weight:600;
  border:1.5px solid var(--border);background:var(--card);color:var(--text2);
  cursor:pointer;font-family:inherit;white-space:nowrap;
  transition:background 0.25s,color 0.25s,border-color 0.25s,transform 0.38s var(--spring);
  will-change:transform;
}
.filter-pill.active{background:var(--accent);color:#fff;border-color:var(--accent);}
.filter-pill:hover:not(.active){border-color:var(--accent);color:var(--accent);transform:translateY(-2px);}
.filter-pill:active{transform:scale(0.9);}

/* ‚îÄ‚îÄ GALLERY ‚îÄ‚îÄ */
.gallery-controls{display:flex;align-items:center;padding:0 22px 10px;}
.gallery-controls .section-title{flex:1;}
.layout-btns{display:flex;background:var(--card);border:1px solid var(--border);border-radius:10px;padding:3px;gap:2px;box-shadow:var(--sh);}
.lbtn{
  width:28px;height:28px;border-radius:7px;border:none;
  background:transparent;color:var(--text2);font-size:0.68rem;font-weight:800;
  cursor:pointer;font-family:inherit;display:flex;align-items:center;justify-content:center;
  transition:background 0.25s,color 0.25s,transform 0.35s var(--spring);
  will-change:transform;
}
.lbtn.active{background:var(--accent);color:#fff;}
.lbtn:hover:not(.active){background:var(--bg);color:var(--text);}
.lbtn:active{transform:scale(0.85);}

.gallery-wrap{padding:0 22px 20px;}
.photo-masonry{columns:2;column-gap:10px;}
.photo-masonry.col1{columns:1;}
.photo-masonry.col3{columns:3;}

/* ‚îÄ‚îÄ PHOTO ITEM ‚îÄ‚îÄ */
.photo-item{
  break-inside:avoid;margin-bottom:10px;border-radius:14px;overflow:hidden;
  position:relative;cursor:pointer;box-shadow:var(--sh);
  background:var(--card);
  animation:itemIn 0.5s var(--ease-out) both;
  transition:transform 0.42s var(--spring),box-shadow 0.3s var(--ease);
  will-change:transform;
}
@keyframes itemIn{from{opacity:0;transform:translateY(18px) scale(0.96);}to{opacity:1;transform:translateY(0) scale(1);}}
.photo-item:hover{transform:translateY(-6px) scale(1.02);box-shadow:var(--sh-lg);}
.photo-item:active{transform:scale(0.96);}
.photo-item img{width:100%;height:auto;display:block;transition:transform 0.65s var(--ease);}
.photo-item:hover img{transform:scale(1.08);}
.photo-overlay{
  position:absolute;inset:0;
  background:linear-gradient(to top,rgba(15,17,38,0.82) 0%,transparent 55%);
  opacity:0;transition:opacity 0.3s var(--ease);
  display:flex;flex-direction:column;justify-content:flex-end;padding:10px;
}
.photo-item:hover .photo-overlay{opacity:1;}
.photo-date{font-size:0.58rem;color:rgba(255,255,255,0.65);font-weight:500;margin-bottom:5px;}
.photo-actions{display:flex;gap:4px;}
.photo-act-btn{
  background:rgba(255,255,255,0.14);border:1px solid rgba(255,255,255,0.22);
  color:#fff;padding:3px 8px;border-radius:100px;font-size:0.58rem;font-weight:700;
  cursor:pointer;backdrop-filter:blur(8px);font-family:inherit;
  transition:background 0.22s,color 0.22s,transform 0.35s var(--spring);
  will-change:transform;
}
.photo-act-btn:hover{background:rgba(255,255,255,0.9);color:var(--text);transform:scale(1.1);}
.photo-act-btn:active{transform:scale(0.88);}
.photo-act-btn.del:hover{background:#ef4444;border-color:#ef4444;color:#fff;}

/* ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ */
.bottom-nav{
  position:fixed;bottom:0;left:50%;transform:translateX(-50%);
  width:100%;max-width:430px;
  background:rgba(255,255,255,0.88);
  backdrop-filter:blur(26px) saturate(1.8);
  border-top:1px solid rgba(0,0,0,0.06);
  display:flex;align-items:stretch;z-index:100;
  box-shadow:0 -8px 40px rgba(67,97,238,0.08);
  padding-bottom:env(safe-area-inset-bottom,0);
  transition:background 0.4s var(--ease);
}
[data-theme="dark"] .bottom-nav{background:rgba(24,27,46,0.92);border-top-color:rgba(255,255,255,0.06);}
.nav-item{
  flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:3px;padding:12px 8px;
  cursor:pointer;border:none;background:transparent;font-family:inherit;
  color:var(--text2);position:relative;
  transition:color 0.25s var(--ease);
  -webkit-tap-highlight-color:transparent;
}
.nav-icon-wrap{transition:transform 0.38s var(--spring);will-change:transform;}
.nav-item:active .nav-icon-wrap{transform:scale(0.82);}
.nav-item.active .nav-icon-wrap{transform:translateY(-3px);}
.nav-item.active{color:var(--accent);}
.nav-item.active::before{
  content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);
  width:28px;height:3px;border-radius:0 0 6px 6px;background:var(--accent);
  animation:tabIndicator 0.35s var(--spring);
}
@keyframes tabIndicator{from{transform:translateX(-50%) scaleX(0);}to{transform:translateX(-50%) scaleX(1);}}
.nav-icon{font-size:1.3rem;line-height:1;display:block;}
.nav-label{font-size:0.58rem;font-weight:600;letter-spacing:0.02em;}
.nav-badge{
  position:absolute;top:8px;right:14px;
  background:var(--accent);color:#fff;font-size:0.5rem;font-weight:800;
  min-width:15px;height:15px;border-radius:100px;
  display:flex;align-items:center;justify-content:center;padding:0 3px;
  box-shadow:0 2px 6px rgba(67,97,238,0.4);
  animation:badgePop 0.4s var(--spring);
}
@keyframes badgePop{from{transform:scale(0);}to{transform:scale(1);}}

/* ‚îÄ‚îÄ PAGE HEADER ‚îÄ‚îÄ */
.page-header{padding:54px 22px 16px;}
.page-header h2{font-family:'DM Serif Display',serif;font-size:1.4rem;font-weight:400;color:var(--text);}
.page-sub{font-size:0.72rem;color:var(--text2);margin-top:3px;}

/* ‚îÄ‚îÄ SETTINGS ‚îÄ‚îÄ */
.settings-section{margin:0 22px 18px;}
.settings-label{font-size:0.62rem;font-weight:700;color:var(--text2);letter-spacing:0.08em;text-transform:uppercase;margin-bottom:8px;padding:0 4px;}
.settings-group{background:var(--card);border-radius:var(--radius);border:1px solid var(--border);overflow:hidden;box-shadow:var(--sh);}
.settings-item{
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 16px;border-bottom:1px solid var(--border);cursor:pointer;
  transition:background 0.22s var(--ease);
}
.settings-item:last-child{border-bottom:none;}
.settings-item:hover{background:var(--bg);}
.settings-item:active{background:var(--accent-light);}
.si-left{display:flex;align-items:center;gap:12px;}
.si-icon{
  width:36px;height:36px;border-radius:10px;
  display:flex;align-items:center;justify-content:center;font-size:1rem;
  transition:transform 0.38s var(--spring);flex-shrink:0;
}
.settings-item:hover .si-icon{transform:scale(1.18) rotate(-6deg);}
.si-blue{background:#dbeafe;} .si-purple{background:#ede9fe;} .si-green{background:#dcfce7;}
.si-orange{background:#ffedd5;} .si-pink{background:#fce7f3;} .si-red{background:#fee2e2;}
.si-text h4{font-size:0.82rem;font-weight:600;color:var(--text);}
.si-text p{font-size:0.68rem;color:var(--text2);margin-top:1px;}
.si-right{display:flex;align-items:center;gap:8px;color:var(--text3);font-size:0.85rem;}

/* Toggle */
.toggle-sw{
  width:46px;height:26px;border-radius:100px;
  background:var(--border);position:relative;cursor:pointer;flex-shrink:0;
  transition:background 0.32s var(--ease);
}
.toggle-sw.on{background:var(--accent);}
.toggle-sw::after{
  content:'';position:absolute;top:3px;left:3px;
  width:20px;height:20px;border-radius:50%;background:#fff;
  box-shadow:0 1px 5px rgba(0,0,0,0.22);
  transition:left 0.32s var(--spring);
}
.toggle-sw.on::after{left:23px;}

/* Color picker */
.theme-colors{display:flex;gap:9px;padding:14px 16px;flex-wrap:wrap;}
.color-dot{
  width:32px;height:32px;border-radius:50%;cursor:pointer;
  border:3px solid transparent;
  transition:transform 0.38s var(--spring),border-color 0.25s;
  will-change:transform;
}
.color-dot.active{border-color:var(--text);transform:scale(1.2);}
.color-dot:hover:not(.active){transform:scale(1.12);}
.color-dot:active{transform:scale(0.88);}

/* ‚îÄ‚îÄ LIGHTBOX ‚îÄ‚îÄ */
#lightbox{
  position:fixed;inset:0;
  background:rgba(8,10,20,0.96);
  z-index:1000;display:flex;
  flex-direction:column;align-items:center;justify-content:center;
  backdrop-filter:blur(28px);
  opacity:0;pointer-events:none;
  transition:opacity 0.38s var(--ease-out);
}
#lightbox.active{opacity:1;pointer-events:auto;}
#lightboxImg{
  max-width:90vw;max-height:72vh;object-fit:contain;display:block;
  border-radius:18px;box-shadow:0 40px 80px rgba(0,0,0,0.65);
  transition:opacity 0.22s var(--ease-out),transform 0.22s var(--ease-out);
}
#lightboxImg.swapping{opacity:0;transform:scale(0.92);}
.lb-close{
  position:fixed;top:22px;right:22px;width:42px;height:42px;border-radius:50%;
  background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.2);
  color:#fff;font-size:1rem;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  transition:background 0.22s,transform 0.38s var(--spring);
  backdrop-filter:blur(8px);will-change:transform;
}
.lb-close:hover{background:rgba(255,255,255,0.22);transform:scale(1.1) rotate(90deg);}
.lb-close:active{transform:scale(0.88);}
.lb-controls{display:flex;align-items:center;gap:8px;margin-top:18px;}
.lb-btn{
  background:rgba(255,255,255,0.11);border:1px solid rgba(255,255,255,0.2);
  color:#fff;padding:8px 18px;border-radius:100px;
  font-family:inherit;font-size:0.7rem;font-weight:700;cursor:pointer;
  backdrop-filter:blur(8px);
  transition:background 0.22s,transform 0.38s var(--spring);will-change:transform;
}
.lb-btn:hover{background:rgba(255,255,255,0.22);transform:translateY(-2px);}
.lb-btn:active{transform:scale(0.9);}
.lb-btn.danger:hover{background:#ef4444;border-color:#ef4444;}
.lb-counter{color:rgba(255,255,255,0.45);font-size:0.7rem;font-weight:600;min-width:50px;text-align:center;}
.lb-indicator{display:flex;gap:5px;margin-top:14px;}
.lb-dot{
  width:5px;height:5px;border-radius:50%;background:rgba(255,255,255,0.22);cursor:pointer;
  transition:background 0.25s,width 0.32s var(--spring),border-radius 0.32s;
}
.lb-dot.active{background:#fff;width:18px;border-radius:3px;}

/* ‚îÄ‚îÄ SLIDESHOW ‚îÄ‚îÄ */
#slideshowOverlay{
  position:fixed;inset:0;background:#000;z-index:2000;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  opacity:0;pointer-events:none;
  transition:opacity 0.42s var(--ease);
}
#slideshowOverlay.active{opacity:1;pointer-events:auto;}
#ssImg{
  max-width:100vw;max-height:88vh;object-fit:contain;
  transition:opacity 0.55s var(--ease),transform 0.55s var(--ease);
}
#ssImg.ss-leave{opacity:0;transform:scale(1.05);}
#ssImg.ss-enter{opacity:0;transform:scale(0.95);}
.ss-progress{position:fixed;bottom:78px;left:20px;right:20px;height:2px;background:rgba(255,255,255,0.15);border-radius:100px;overflow:hidden;}
.ss-progress-fill{height:100%;background:#fff;border-radius:100px;width:0%;}
.ss-controls{position:fixed;bottom:26px;left:0;right:0;display:flex;align-items:center;justify-content:center;gap:10px;}
.ss-btn{
  background:rgba(255,255,255,0.13);border:1px solid rgba(255,255,255,0.22);
  color:#fff;padding:8px 20px;border-radius:100px;
  font-family:inherit;font-size:0.7rem;font-weight:700;cursor:pointer;
  transition:background 0.22s,transform 0.38s var(--spring);will-change:transform;
}
.ss-btn:hover{background:rgba(255,255,255,0.24);transform:scale(1.06);}
.ss-btn:active{transform:scale(0.92);}
.ss-close{
  position:fixed;top:22px;right:22px;width:40px;height:40px;border-radius:50%;
  background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.22);
  color:#fff;display:flex;align-items:center;justify-content:center;
  cursor:pointer;font-size:1rem;
  transition:background 0.22s,transform 0.38s var(--spring);will-change:transform;
}
.ss-close:hover{background:rgba(255,255,255,0.22);transform:rotate(90deg) scale(1.1);}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
#toast{
  position:fixed;bottom:92px;left:50%;
  transform:translateX(-50%) translateY(12px);
  background:var(--text);color:#fff;
  padding:11px 22px;border-radius:100px;
  font-size:0.74rem;font-weight:600;
  z-index:9000;opacity:0;
  transition:opacity 0.32s var(--ease-out),transform 0.42s var(--spring);
  pointer-events:none;white-space:nowrap;
  box-shadow:var(--sh-lg);
  max-width:calc(100vw - 48px);
}
#toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
#toast.ok{background:var(--green);}
#toast.err{background:#ef4444;}

/* ‚îÄ‚îÄ MISC ‚îÄ‚îÄ */
.notice-card{
  margin:0 22px 16px;background:var(--accent-light);
  border:1px solid rgba(67,97,238,0.18);border-radius:var(--radius-sm);padding:12px 14px;
  display:flex;align-items:flex-start;gap:10px;
}
.notice-icon{font-size:1rem;flex-shrink:0;margin-top:1px;}
.notice-text{font-size:0.71rem;color:var(--accent);font-weight:500;line-height:1.55;}
.slideshow-card{
  margin:0 22px 16px;
  background:linear-gradient(135deg,#0f172a,#1e1b4b);
  border-radius:var(--radius);padding:22px;color:#fff;cursor:pointer;
  position:relative;overflow:hidden;
  box-shadow:0 12px 40px rgba(30,27,75,0.4);
  transition:transform 0.42s var(--spring),box-shadow 0.3s;will-change:transform;
}
.slideshow-card:hover{transform:translateY(-5px) scale(1.01);box-shadow:0 22px 60px rgba(30,27,75,0.55);}
.slideshow-card:active{transform:scale(0.97);}
.slideshow-card::after{position:absolute;right:-8px;bottom:-8px;font-size:5rem;opacity:0.07;content:'üéûÔ∏è';}

.empty-state{text-align:center;padding:48px 20px;animation:itemIn 0.4s var(--ease-out);}
.empty-icon{font-size:3rem;margin-bottom:14px;display:block;animation:float 3s ease-in-out infinite;}
@keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-10px);}}
.empty-title{font-size:1rem;font-weight:700;margin-bottom:6px;}
.empty-sub{font-size:0.78rem;color:var(--text2);}

::-webkit-scrollbar{width:0;height:0;}
::selection{background:rgba(67,97,238,0.18);color:var(--accent);}
</style>
</head>
<body>
<div class="app-shell">

  <!-- ‚ïê‚ïê HOME ‚ïê‚ïê -->
  <div class="page active" id="page-home">
    <div class="topbar" id="tb-home">
      <div class="topbar-left">
        <div class="avatar" id="avatarBtn">B</div>
        <div class="topbar-greeting">
          <h1>Hi, Bayu üåø</h1>
          <p id="timeGreet">Kenangan abadi</p>
        </div>
      </div>
      <div class="topbar-actions">
        <button class="icon-btn" id="themeBtn" onclick="toggleTheme()">üåô</button>
        <button class="icon-btn primary" onclick="gotoPage('gallery')">Ôºã</button>
      </div>
    </div>
    <div class="stats-bar">
      <div class="stat-card"><span class="stat-icon">üñºÔ∏è</span><div class="stat-num" id="statPhotos">0</div><div class="stat-label">Foto</div></div>
      <div class="stat-card"><span class="stat-icon">üìÖ</span><div class="stat-num" id="statDays">‚Äì</div><div class="stat-label">Hari</div></div>
      <div class="stat-card"><span class="stat-icon">üíæ</span><div class="stat-num" id="statSize">0MB</div><div class="stat-label">Storage</div></div>
    </div>
    <div class="tribute-card">
      <h3>In Memory of Bayu ‚ú¶</h3>
      <p>Setiap foto adalah cahaya yang tidak pernah padam. Kenangan ini akan selalu hidup di hati kita.</p>
      <div class="tribute-years">Selalu dikenang ¬∑ Selalu dicintai</div>
    </div>
    <div class="section-header">
      <span class="section-title">Foto Terbaru</span>
      <button class="section-link" onclick="gotoPage('gallery')">Lihat Semua</button>
    </div>
    <div class="feature-scroll" id="recentStrip">
      <div class="feature-card-add" onclick="gotoPage('gallery')"><span>üì∑</span><p>Upload Foto</p></div>
    </div>
    <div class="section-header"><span class="section-title">Album</span></div>
    <div class="room-tabs">
      <div class="room-tab active" onclick="selectTab(this)">Semua</div>
      <div class="room-tab" onclick="selectTab(this)">Keluarga</div>
      <div class="room-tab" onclick="selectTab(this)">Momen</div>
      <div class="room-tab" onclick="selectTab(this)">Kenangan</div>
      <div class="room-tab" onclick="selectTab(this)">Favorit ‚≠ê</div>
    </div>
    <div class="section-header"><span class="section-title">Aksi Cepat</span></div>
    <div class="device-grid">
      <div class="device-card on blue" onclick="startSlideshow()"><div class="device-icon">‚ñ∂Ô∏è</div><div class="device-name">Slideshow</div><div class="device-val">Putar semua</div></div>
      <div class="device-card on orange" onclick="downloadAll()"><div class="device-icon">‚¨áÔ∏è</div><div class="device-name">Download</div><div class="device-val">Semua foto</div></div>
      <div class="device-card on teal" onclick="shareGallery()"><div class="device-icon">üîó</div><div class="device-name">Bagikan</div><div class="device-val">Link galeri</div></div>
      <div class="device-card" onclick="gotoPage('gallery')"><div class="device-icon">üñºÔ∏è</div><div class="device-name">Galeri</div><div class="device-val">Lihat semua</div><div class="device-toggle on"></div></div>
      <div class="device-card" onclick="gotoPage('gallery');setTimeout(()=>document.getElementById('searchInput').focus(),450)"><div class="device-icon">üîç</div><div class="device-name">Cari Foto</div><div class="device-val">Pencarian</div><div class="device-toggle off"></div></div>
      <div class="device-card" onclick="gotoPage('settings')"><div class="device-icon">‚öôÔ∏è</div><div class="device-name">Pengaturan</div><div class="device-val">Kustomisasi</div><div class="device-toggle off"></div></div>
    </div>
  </div>

  <!-- ‚ïê‚ïê GALLERY ‚ïê‚ïê -->
  <div class="page" id="page-gallery">
    <div class="topbar" id="tb-gallery">
      <div><div style="font-family:'DM Serif Display',serif;font-size:1.35rem;color:var(--text)">Galeri Foto</div>
      <div class="page-sub" id="gallerySubtitle">Memuat...</div></div>
    </div>
    <div class="upload-area" id="dropArea">
      <span class="upload-icon">üì§</span>
      <div class="upload-title">Seret & lepas foto di sini</div>
      <div class="upload-sub">JPG ¬∑ PNG ¬∑ WEBP ¬∑ Bisa banyak sekaligus</div>
      <label class="upload-btn">Ôºã Pilih Foto<input type="file" id="fileInput" multiple accept="image/*" style="display:none"></label>
      <div class="progress-wrap" id="progressWrap">
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        <div class="progress-label" id="progressLabel">Mengunggah...</div>
      </div>
    </div>
    <div class="search-bar"><span>üîç</span><input type="text" placeholder="Cari foto..." id="searchInput" oninput="filterPhotos()"></div>
    <div class="filter-pills">
      <button class="filter-pill active" onclick="setFilter('all',this)">Semua</button>
      <button class="filter-pill" onclick="setFilter('recent',this)">Terbaru</button>
      <button class="filter-pill" onclick="setFilter('oldest',this)">Terlama</button>
      <button class="filter-pill" onclick="setFilter('favorit',this)">Favorit ‚≠ê</button>
    </div>
    <div class="gallery-controls">
      <span class="section-title" id="photoCountEl">0 Foto</span>
      <div class="layout-btns">
        <button class="lbtn" onclick="setLayout(1,this)">‚ò∞</button>
        <button class="lbtn active" onclick="setLayout(2,this)">‚äû</button>
        <button class="lbtn" onclick="setLayout(3,this)">‚äü</button>
      </div>
    </div>
    <div class="gallery-wrap"><div class="photo-masonry" id="photoGrid">
      <div class="empty-state"><span class="empty-icon">üåÖ</span><div class="empty-title">Belum ada foto</div><div class="empty-sub">Upload foto pertama untuk memulai kenangan</div></div>
    </div></div>
  </div>

  <!-- ‚ïê‚ïê MEMORIES ‚ïê‚ïê -->
  <div class="page" id="page-memories">
    <div class="topbar" id="tb-memories">
      <div><div style="font-family:'DM Serif Display',serif;font-size:1.35rem;color:var(--text)">Kenangan</div>
      <div class="page-sub">Momen spesial tersimpan</div></div>
    </div>
    <div class="notice-card"><div class="notice-icon">üí°</div><div class="notice-text">Tandai foto dengan ‚≠ê untuk menampilkannya di halaman ini.</div></div>
    <div class="section-header"><span class="section-title">Slideshow</span></div>
    <div class="slideshow-card" onclick="startSlideshow()">
      <div style="font-size:2.2rem;margin-bottom:10px">‚ñ∂Ô∏è</div>
      <div style="font-weight:700;font-size:0.95rem;margin-bottom:4px">Putar Slideshow</div>
      <div style="font-size:0.72rem;opacity:0.6">Tampilkan semua foto secara otomatis</div>
    </div>
    <div class="section-header"><span class="section-title">Foto Favorit ‚≠ê</span></div>
    <div class="gallery-wrap"><div class="photo-masonry" id="favGrid">
      <div class="empty-state"><span class="empty-icon">‚≠ê</span><div class="empty-title">Belum ada favorit</div><div class="empty-sub">Klik ‚≠ê pada foto untuk menandai</div></div>
    </div></div>
  </div>

  <!-- ‚ïê‚ïê SETTINGS ‚ïê‚ïê -->
  <div class="page" id="page-settings">
    <div class="topbar" id="tb-settings">
      <div><div style="font-family:'DM Serif Display',serif;font-size:1.35rem;color:var(--text)">Pengaturan</div>
      <div class="page-sub">Kustomisasi galerimu</div></div>
    </div>
    <div class="settings-section">
      <div class="settings-label">Profil</div>
      <div class="settings-group">
        <div class="settings-item"><div class="si-left"><div class="si-icon si-blue">üë§</div><div class="si-text"><h4>Nama Galeri</h4><p>In Memory of Bayu</p></div></div><div class="si-right">‚Ä∫</div></div>
        <div class="settings-item"><div class="si-left"><div class="si-icon si-purple">üñºÔ∏è</div><div class="si-text"><h4>Foto Profil</h4><p>Ubah avatar</p></div></div><div class="si-right"><label style="cursor:pointer;font-size:0.72rem;color:var(--accent);font-weight:600;padding:5px 12px;background:var(--accent-light);border-radius:100px">Pilih<input type="file" accept="image/*" id="avatarInput" style="display:none" onchange="changeAvatar(event)"></label></div></div>
      </div>
    </div>
    <div class="settings-section">
      <div class="settings-label">Tampilan</div>
      <div class="settings-group">
        <div class="settings-item"><div class="si-left"><div class="si-icon si-purple">üåô</div><div class="si-text"><h4>Mode Gelap</h4><p>Aktifkan dark mode</p></div></div><div class="si-right"><div class="toggle-sw" id="darkToggle" onclick="toggleTheme()"></div></div></div>
        <div class="settings-item" style="cursor:default"><div class="si-left" style="width:100%;flex-direction:column;align-items:flex-start;gap:8px">
          <div style="display:flex;align-items:center;gap:12px;width:100%"><div class="si-icon si-orange">üé®</div><div class="si-text"><h4>Warna Aksen</h4><p>Pilih warna tema</p></div></div>
          <div class="theme-colors">
            <div class="color-dot active" style="background:#4361ee" onclick="setAccent('#4361ee','#eef2ff',this)"></div>
            <div class="color-dot" style="background:#7c3aed" onclick="setAccent('#7c3aed','#ede9fe',this)"></div>
            <div class="color-dot" style="background:#ec4899" onclick="setAccent('#ec4899','#fce7f3',this)"></div>
            <div class="color-dot" style="background:#14b8a6" onclick="setAccent('#14b8a6','#ccfbf1',this)"></div>
            <div class="color-dot" style="background:#22c55e" onclick="setAccent('#22c55e','#dcfce7',this)"></div>
            <div class="color-dot" style="background:#f97316" onclick="setAccent('#f97316','#ffedd5',this)"></div>
            <div class="color-dot" style="background:#ef4444" onclick="setAccent('#ef4444','#fee2e2',this)"></div>
            <div class="color-dot" style="background:#1a1d2e" onclick="setAccent('#1a1d2e','#e4e7f0',this)"></div>
          </div>
        </div></div>
        <div class="settings-item"><div class="si-left"><div class="si-icon si-blue">üìê</div><div class="si-text"><h4>Kolom Galeri</h4><p id="colLabel">2 kolom</p></div></div>
        <div class="si-right" style="gap:5px">
          <button onclick="setLayout(1,null,true)" style="padding:4px 10px;border-radius:8px;border:1.5px solid var(--border);background:var(--bg);font-size:0.7rem;cursor:pointer;font-family:inherit;color:var(--text);transition:all 0.25s">1</button>
          <button onclick="setLayout(2,null,true)" style="padding:4px 10px;border-radius:8px;border:1.5px solid var(--border);background:var(--bg);font-size:0.7rem;cursor:pointer;font-family:inherit;color:var(--text);transition:all 0.25s">2</button>
          <button onclick="setLayout(3,null,true)" style="padding:4px 10px;border-radius:8px;border:1.5px solid var(--border);background:var(--bg);font-size:0.7rem;cursor:pointer;font-family:inherit;color:var(--text);transition:all 0.25s">3</button>
        </div></div>
      </div>
    </div>
    <div class="settings-section">
      <div class="settings-label">Galeri</div>
      <div class="settings-group">
        <div class="settings-item" onclick="startSlideshow()"><div class="si-left"><div class="si-icon si-blue">‚ñ∂Ô∏è</div><div class="si-text"><h4>Putar Slideshow</h4><p>Tampilkan semua foto</p></div></div><div class="si-right" style="color:var(--accent);font-size:0.7rem;font-weight:600">Putar ‚Üí</div></div>
        <div class="settings-item" onclick="downloadAll()"><div class="si-left"><div class="si-icon si-green">‚¨áÔ∏è</div><div class="si-text"><h4>Download Semua</h4><p>Unduh seluruh galeri</p></div></div><div class="si-right" style="color:var(--accent);font-size:0.7rem;font-weight:600">Unduh ‚Üí</div></div>
        <div class="settings-item" onclick="shareGallery()"><div class="si-left"><div class="si-icon si-pink">üîó</div><div class="si-text"><h4>Bagikan Galeri</h4><p>Salin link halaman ini</p></div></div><div class="si-right" style="color:var(--accent);font-size:0.7rem;font-weight:600">Share ‚Üí</div></div>
        <div class="settings-item" onclick="clearAll()"><div class="si-left"><div class="si-icon si-red">üóëÔ∏è</div><div class="si-text"><h4>Hapus Semua Foto</h4><p>Tidak bisa dikembalikan!</p></div></div><div class="si-right" style="color:#ef4444;font-size:0.7rem;font-weight:700">Hapus</div></div>
      </div>
    </div>
    <div style="text-align:center;padding:20px 22px 32px;font-size:0.72rem;color:var(--text3)">
      Dibuat dengan ‚ù§Ô∏è untuk mengenang <strong style="color:var(--accent)">Bayu</strong> ¬∑ v2.1
    </div>
  </div>

  <!-- BOTTOM NAV -->
  <nav class="bottom-nav">
    <button class="nav-item active" onclick="gotoPage('home')" id="nav-home"><div class="nav-icon-wrap"><span class="nav-icon">üè†</span></div><span class="nav-label">Beranda</span></button>
    <button class="nav-item" onclick="gotoPage('gallery')" id="nav-gallery" style="position:relative"><div class="nav-icon-wrap"><span class="nav-icon">üñºÔ∏è</span></div><span class="nav-label">Galeri</span><span class="nav-badge" id="photoBadge" style="display:none">0</span></button>
    <button class="nav-item" onclick="gotoPage('memories')" id="nav-memories"><div class="nav-icon-wrap"><span class="nav-icon">‚≠ê</span></div><span class="nav-label">Kenangan</span></button>
    <button class="nav-item" onclick="gotoPage('settings')" id="nav-settings"><div class="nav-icon-wrap"><span class="nav-icon">‚öôÔ∏è</span></div><span class="nav-label">Pengaturan</span></button>
  </nav>
</div>

<!-- LIGHTBOX -->
<div id="lightbox">
  <button class="lb-close" onclick="closeLightbox()">‚úï</button>
  <img id="lightboxImg" src="" alt="">
  <div class="lb-controls">
    <button class="lb-btn" onclick="lbNav(-1)">‚Üê Prev</button>
    <span class="lb-counter" id="lbCounter">1/1</span>
    <button class="lb-btn" onclick="lbNav(1)">Next ‚Üí</button>
  </div>
  <div class="lb-controls" style="margin-top:6px">
    <button class="lb-btn" onclick="lbDownload()">‚¨á Unduh</button>
    <button class="lb-btn" onclick="lbFavorite()">‚≠ê Favorit</button>
    <button class="lb-btn danger" onclick="lbDelete()">üóë Hapus</button>
  </div>
  <div class="lb-indicator" id="lbIndicator"></div>
</div>

<!-- SLIDESHOW -->
<div id="slideshowOverlay">
  <button class="ss-close" onclick="stopSlideshow()">‚úï</button>
  <img id="ssImg" src="" alt="">
  <div class="ss-progress"><div class="ss-progress-fill" id="ssProgressFill"></div></div>
  <div class="ss-controls">
    <button class="ss-btn" onclick="ssNav(-1)">‚Üê Prev</button>
    <button class="ss-btn" id="ssPauseBtn" onclick="ssPause()">‚è∏ Pause</button>
    <button class="ss-btn" onclick="ssNav(1)">Next ‚Üí</button>
  </div>
</div>

<div id="toast"></div>

<script>
// ‚îÄ‚îÄ SUPABASE ‚îÄ‚îÄ
const SUPABASE_URL='https://olkokmuburmgslpsiwpi.supabase.co';
const SUPABASE_KEY='sb_publishable_FHgCHk8ocJPkEGWUiejlCA_BHRcN17v';
const BUCKET='images';
const {createClient}=supabase;
const sb=createClient(SUPABASE_URL,SUPABASE_KEY);

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ
let photos=[], favorites=JSON.parse(localStorage.getItem('favs')||'[]');
let activeFilterState='all', currentCols=2, lightboxIdx=0;
let ssIdx=0, ssTimer=null, ssPaused=false;
let toastTimer=null, currentPage='home';

// ‚îÄ‚îÄ GREETING ‚îÄ‚îÄ
(function(){
  const h=new Date().getHours();
  document.getElementById('timeGreet').textContent=
    h<11?'Selamat pagi ‚òÄÔ∏è':h<15?'Selamat siang üå§Ô∏è':h<18?'Selamat sore üåÖ':'Selamat malam üåô';
})();

// ‚îÄ‚îÄ TOPBAR SCROLL EFFECT ‚îÄ‚îÄ
document.querySelectorAll('.page').forEach(pg=>{
  const id=pg.id.replace('page-','');
  pg.addEventListener('scroll',()=>{
    const tb=document.getElementById('tb-'+id);
    if(tb) tb.classList.toggle('scrolled',pg.scrollTop>8);
  },{passive:true});
});

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ
function toast(msg,type=''){
  clearTimeout(toastTimer);
  const el=document.getElementById('toast');
  el.textContent=msg; el.className='show '+(type||'');
  toastTimer=setTimeout(()=>el.className='',3000);
}

// ‚îÄ‚îÄ SMOOTH PAGE TRANSITION ‚îÄ‚îÄ
function gotoPage(name){
  if(name===currentPage) return;
  const prev=document.getElementById('page-'+currentPage);
  const next=document.getElementById('page-'+name);
  if(!next) return;

  // exit current
  prev.style.transition='opacity 0.28s cubic-bezier(0.4,0,1,1),transform 0.28s cubic-bezier(0.4,0,1,1)';
  prev.style.opacity='0';
  prev.style.transform='translateY(-10px) scale(0.98)';
  prev.style.pointerEvents='none';

  // prepare next (off-screen below)
  next.style.transition='none';
  next.style.opacity='0';
  next.style.transform='translateY(20px)';
  next.style.pointerEvents='none';
  next.classList.add('active');

  setTimeout(()=>{
    prev.classList.remove('active');
    prev.style.transition='';
    prev.style.opacity=''; prev.style.transform='';

    // animate next in
    next.style.transition='opacity 0.38s cubic-bezier(0,0,0.2,1),transform 0.38s cubic-bezier(0,0,0.2,1)';
    next.style.opacity='1';
    next.style.transform='translateY(0)';
    next.style.pointerEvents='auto';

    setTimeout(()=>{
      next.style.transition='';
      next.style.opacity=''; next.style.transform='';
    },400);
  },200);

  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById('nav-'+name)?.classList.add('active');
  currentPage=name;
  if(name==='memories') setTimeout(renderFavGrid,250);
}

// ‚îÄ‚îÄ TABS ‚îÄ‚îÄ
function selectTab(el){document.querySelectorAll('.room-tab').forEach(t=>t.classList.remove('active'));el.classList.add('active');}

// ‚îÄ‚îÄ THEME ‚îÄ‚îÄ
function toggleTheme(){
  const isDark=document.documentElement.getAttribute('data-theme')==='dark';
  document.documentElement.setAttribute('data-theme',isDark?'':'dark');
  document.getElementById('darkToggle').classList.toggle('on',!isDark);
  document.getElementById('themeBtn').textContent=isDark?'üåô':'‚òÄÔ∏è';
  localStorage.setItem('theme',isDark?'':'dark');
}
(()=>{if(localStorage.getItem('theme')==='dark'){document.documentElement.setAttribute('data-theme','dark');document.addEventListener('DOMContentLoaded',()=>{document.getElementById('darkToggle')?.classList.add('on');document.getElementById('themeBtn').textContent='‚òÄÔ∏è';});}})();

// ‚îÄ‚îÄ ACCENT ‚îÄ‚îÄ
function setAccent(c,l,el){
  document.documentElement.style.setProperty('--accent',c);
  document.documentElement.style.setProperty('--accent-light',l);
  document.querySelectorAll('.color-dot').forEach(d=>d.classList.remove('active'));
  el?.classList.add('active');
  localStorage.setItem('accent',JSON.stringify({c,l}));
}
(()=>{const a=JSON.parse(localStorage.getItem('accent')||'null');if(a){document.documentElement.style.setProperty('--accent',a.c);document.documentElement.style.setProperty('--accent-light',a.l);}})();

// ‚îÄ‚îÄ AVATAR ‚îÄ‚îÄ
function changeAvatar(e){
  const f=e.target.files[0];if(!f) return;
  const r=new FileReader();
  r.onload=ev=>{document.getElementById('avatarBtn').innerHTML=`<img src="${ev.target.result}" alt="">`;localStorage.setItem('avatar',ev.target.result);toast('Foto profil diperbarui','ok');};
  r.readAsDataURL(f);
}
(()=>{const av=localStorage.getItem('avatar');if(av)document.getElementById('avatarBtn').innerHTML=`<img src="${av}" alt="">`;})();

// ‚îÄ‚îÄ LOAD ‚îÄ‚îÄ
async function loadPhotos(){
  try{
    const{data,error}=await sb.storage.from(BUCKET).list('',{limit:500,sortBy:{column:'created_at',order:'desc'}});
    if(error) throw error;
    photos=(data||[]).filter(f=>f.name&&/\.(jpe?g|png|webp|gif)$/i.test(f.name)).map(f=>{
      const{data:u}=sb.storage.from(BUCKET).getPublicUrl(f.name);
      return{name:f.name,url:u.publicUrl,created:f.created_at,size:f.metadata?.size||0};
    });
    renderGallery(); renderRecentStrip(); updateStats();
  }catch(e){console.error(e);toast('Gagal memuat foto','err');}
}

// ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ
function renderGallery(){
  const grid=document.getElementById('photoGrid');
  const list=getFiltered();
  document.getElementById('photoCountEl').textContent=list.length+' Foto';
  document.getElementById('gallerySubtitle').textContent=list.length+' foto tersimpan';
  if(!list.length){
    grid.innerHTML=`<div class="empty-state"><span class="empty-icon">üåÖ</span><div class="empty-title">Tidak ada foto</div><div class="empty-sub">Coba filter lain atau upload foto baru</div></div>`;
    updateBadge();return;
  }
  grid.innerHTML=list.map((p,i)=>`
    <div class="photo-item" style="animation-delay:${Math.min(i*0.045,0.55)}s">
      <img src="${p.url}" alt="${p.name}" loading="lazy" onerror="this.parentElement.style.display='none'">
      <div class="photo-overlay">
        <div class="photo-date">${fmtDate(p.created)}</div>
        <div class="photo-actions">
          <button class="photo-act-btn" onclick="openLightbox(${photos.indexOf(p)});event.stopPropagation()">üîç</button>
          <button class="photo-act-btn" onclick="toggleFav('${p.name}');event.stopPropagation()">${favorites.includes(p.name)?'‚≠ê':'‚òÜ'}</button>
          <button class="photo-act-btn" onclick="dlPhoto('${p.url}','${p.name}');event.stopPropagation()">‚¨á</button>
          <button class="photo-act-btn del" onclick="deletePhoto('${p.name}');event.stopPropagation()">üóë</button>
        </div>
      </div>
    </div>`).join('');
  grid.querySelectorAll('.photo-item img').forEach((img,i)=>{img.onclick=()=>openLightbox(photos.indexOf(list[i]));});
  updateBadge();
}

function renderFavGrid(){
  const grid=document.getElementById('favGrid');
  const fp=photos.filter(p=>favorites.includes(p.name));
  if(!fp.length){grid.innerHTML=`<div class="empty-state"><span class="empty-icon">‚≠ê</span><div class="empty-title">Belum ada favorit</div><div class="empty-sub">Klik ‚≠ê pada foto untuk menandai</div></div>`;return;}
  grid.innerHTML=fp.map((p,i)=>`<div class="photo-item" style="animation-delay:${i*0.05}s"><img src="${p.url}" alt="${p.name}" loading="lazy"><div class="photo-overlay"><div class="photo-date">${fmtDate(p.created)}</div><div class="photo-actions"><button class="photo-act-btn" onclick="openLightbox(${photos.indexOf(p)});event.stopPropagation()">üîç</button><button class="photo-act-btn" onclick="toggleFav('${p.name}');event.stopPropagation()">‚≠ê</button></div></div></div>`).join('');
}

function renderRecentStrip(){
  const strip=document.getElementById('recentStrip');
  const add=`<div class="feature-card-add" onclick="gotoPage('gallery')"><span>üì∑</span><p>Upload Foto</p></div>`;
  if(!photos.length){strip.innerHTML=add;return;}
  strip.innerHTML=add+photos.slice(0,8).map((p,i)=>`<div class="feature-card" style="animation-delay:${i*0.06}s" onclick="openLightbox(${i})"><img src="${p.url}" loading="lazy"><div class="feature-card-overlay"></div><div class="feature-card-label"><div class="live-dot"></div>${fmtDate(p.created)}</div></div>`).join('');
}

function updateStats(){
  document.getElementById('statPhotos').textContent=photos.length;
  document.getElementById('statSize').textContent=(photos.reduce((a,p)=>a+(p.size||0),0)/1024/1024).toFixed(1)+'MB';
  if(photos.length){const e=new Date(Math.min(...photos.map(p=>new Date(p.created).getTime())));document.getElementById('statDays').textContent=Math.floor((Date.now()-e)/86400000);}
}
function updateBadge(){const b=document.getElementById('photoBadge');if(photos.length){b.style.display='flex';b.textContent=photos.length>99?'99+':photos.length;}else b.style.display='none';}

// ‚îÄ‚îÄ FILTER ‚îÄ‚îÄ
function setFilter(f,el){activeFilterState=f;document.querySelectorAll('.filter-pill').forEach(p=>p.classList.remove('active'));el?.classList.add('active');renderGallery();}
function getFiltered(){
  const q=document.getElementById('searchInput')?.value.toLowerCase()||'';
  let l=[...photos];
  if(activeFilterState==='recent') l.sort((a,b)=>new Date(b.created)-new Date(a.created));
  else if(activeFilterState==='oldest') l.sort((a,b)=>new Date(a.created)-new Date(b.created));
  else if(activeFilterState==='favorit') l=l.filter(p=>favorites.includes(p.name));
  if(q) l=l.filter(p=>p.name.toLowerCase().includes(q));
  return l;
}
function filterPhotos(){renderGallery();}

// ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ
function setLayout(cols,btn,fromSettings=false){
  currentCols=cols;
  const g=document.getElementById('photoGrid');
  g.className='photo-masonry'+(cols===1?' col1':cols===3?' col3':'');
  if(btn){document.querySelectorAll('.lbtn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');}
  if(fromSettings){document.getElementById('colLabel').textContent=cols+' kolom';toast('Kolom galeri: '+cols);}
}

// ‚îÄ‚îÄ UPLOAD ‚îÄ‚îÄ
const dropArea=document.getElementById('dropArea');
document.getElementById('fileInput').addEventListener('change',e=>handleFiles(e.target.files));
['dragenter','dragover'].forEach(ev=>dropArea.addEventListener(ev,e=>{e.preventDefault();dropArea.classList.add('drag-over');}));
['dragleave','drop'].forEach(ev=>dropArea.addEventListener(ev,e=>{e.preventDefault();dropArea.classList.remove('drag-over');}));
dropArea.addEventListener('drop',e=>handleFiles(e.dataTransfer.files));
async function handleFiles(files){
  if(!files.length) return;
  const arr=Array.from(files).filter(f=>f.type.startsWith('image/'));
  if(!arr.length) return toast('Hanya file gambar yang didukung','err');
  const pw=document.getElementById('progressWrap'),pf=document.getElementById('progressFill'),pl=document.getElementById('progressLabel');
  pw.style.display='block'; let done=0;
  for(const file of arr){
    const name=Date.now()+'_'+file.name.replace(/[^a-zA-Z0-9._-]/g,'_');
    const{error}=await sb.storage.from(BUCKET).upload(name,file,{cacheControl:'3600',upsert:false});
    done++; pf.style.width=(done/arr.length*100)+'%'; pl.textContent=`Mengunggah ${done}/${arr.length}...`;
    if(error) toast('Gagal: '+file.name,'err');
  }
  pw.style.display='none'; pf.style.width='0';
  toast('‚úÖ '+done+' foto berhasil diunggah','ok');
  await loadPhotos();
}

// ‚îÄ‚îÄ DELETE ‚îÄ‚îÄ
async function deletePhoto(name){
  if(!confirm('Hapus foto ini?')) return;
  const{error}=await sb.storage.from(BUCKET).remove([name]);
  if(error){toast('Gagal hapus foto','err');return;}
  favorites=favorites.filter(f=>f!==name); localStorage.setItem('favs',JSON.stringify(favorites));
  toast('Foto dihapus','ok'); await loadPhotos(); closeLightbox();
}
async function clearAll(){
  if(!confirm('Hapus SEMUA foto? Tidak bisa dikembalikan!')) return;
  if(!confirm('Yakin? '+photos.length+' foto akan dihapus!')) return;
  const{error}=await sb.storage.from(BUCKET).remove(photos.map(p=>p.name));
  if(error){toast('Gagal hapus semua','err');return;}
  favorites=[];localStorage.setItem('favs','[]'); await loadPhotos(); toast('Semua foto dihapus','ok');
}

// ‚îÄ‚îÄ FAV ‚îÄ‚îÄ
function toggleFav(name){
  if(favorites.includes(name)){favorites=favorites.filter(f=>f!==name);toast('Dihapus dari favorit');}
  else{favorites.push(name);toast('‚≠ê Ditambah ke favorit','ok');}
  localStorage.setItem('favs',JSON.stringify(favorites)); renderGallery(); renderFavGrid();
}

// ‚îÄ‚îÄ DOWNLOAD ‚îÄ‚îÄ
function dlPhoto(url,name){const a=document.createElement('a');a.href=url;a.download=name;a.target='_blank';a.click();toast('‚¨á Mengunduh foto');}
function downloadAll(){
  if(!photos.length){toast('Belum ada foto','err');return;}
  photos.slice(0,5).forEach((p,i)=>setTimeout(()=>dlPhoto(p.url,p.name),i*600));
  toast(photos.length>5?'Mengunduh 5 foto pertama...':'Mengunduh '+photos.length+' foto...');
}

// ‚îÄ‚îÄ SHARE ‚îÄ‚îÄ
function shareGallery(){
  if(navigator.share) navigator.share({title:'In Memory of Bayu',url:location.href}).then(()=>toast('Berhasil dibagikan','ok'));
  else{navigator.clipboard?.writeText(location.href);toast('üîó Link disalin ke clipboard','ok');}
}

// ‚îÄ‚îÄ LIGHTBOX ‚îÄ‚îÄ
function openLightbox(idx){
  lightboxIdx=idx;
  const lb=document.getElementById('lightbox');
  lb.classList.add('active');
  lbRender(false);
  document.addEventListener('keydown',lbKey);
  lb.addEventListener('touchstart',e=>{window._lbTX=e.touches[0].clientX;},{passive:true,once:false});
  lb.addEventListener('touchend',e=>{const dx=e.changedTouches[0].clientX-window._lbTX;if(Math.abs(dx)>50)lbNav(dx<0?1:-1);},{passive:true,once:false});
}
function lbRender(anim=true){
  const p=photos[lightboxIdx];if(!p) return;
  const img=document.getElementById('lightboxImg');
  if(anim){img.classList.add('swapping');setTimeout(()=>{img.src=p.url;img.classList.remove('swapping');},230);}
  else img.src=p.url;
  document.getElementById('lbCounter').textContent=`${lightboxIdx+1}/${photos.length}`;
  const max=Math.min(photos.length,15);
  document.getElementById('lbIndicator').innerHTML=Array.from({length:max},(_,i)=>`<div class="lb-dot${i===(lightboxIdx%max)?' active':''}" onclick="openLightbox(${i})"></div>`).join('');
}
function lbNav(dir){lightboxIdx=(lightboxIdx+dir+photos.length)%photos.length;lbRender(true);}
function closeLightbox(){document.getElementById('lightbox').classList.remove('active');document.removeEventListener('keydown',lbKey);}
function lbKey(e){if(e.key==='ArrowRight')lbNav(1);else if(e.key==='ArrowLeft')lbNav(-1);else if(e.key==='Escape')closeLightbox();}
function lbDownload(){const p=photos[lightboxIdx];if(p)dlPhoto(p.url,p.name);}
function lbFavorite(){const p=photos[lightboxIdx];if(p)toggleFav(p.name);}
function lbDelete(){const p=photos[lightboxIdx];if(p)deletePhoto(p.name);}
document.getElementById('lightbox').addEventListener('click',function(e){if(e.target===this)closeLightbox();});

// ‚îÄ‚îÄ SLIDESHOW ‚îÄ‚îÄ
const SS_DUR=4000;
function startSlideshow(){
  if(!photos.length){toast('Belum ada foto','err');return;}
  ssIdx=0;ssPaused=false;
  document.getElementById('ssPauseBtn').textContent='‚è∏ Pause';
  document.getElementById('slideshowOverlay').classList.add('active');
  ssShow(); ssStartTimer();
}
function ssShow(){
  const img=document.getElementById('ssImg');
  img.classList.add('ss-leave');
  setTimeout(()=>{
    img.src=photos[ssIdx]?.url||'';
    img.classList.remove('ss-leave');
    img.classList.add('ss-enter');
    requestAnimationFrame(()=>requestAnimationFrame(()=>img.classList.remove('ss-enter')));
  },280);
}
function ssStartTimer(){
  clearTimeout(ssTimer);
  const fill=document.getElementById('ssProgressFill');
  fill.style.transition='none';fill.style.width='0%';
  requestAnimationFrame(()=>{fill.style.transition=`width ${SS_DUR}ms linear`;fill.style.width='100%';});
  ssTimer=setTimeout(()=>{if(!ssPaused)ssNav(1);},SS_DUR);
}
function ssNav(dir){ssIdx=(ssIdx+dir+photos.length)%photos.length;ssShow();ssStartTimer();}
function ssPause(){
  ssPaused=!ssPaused;
  document.getElementById('ssPauseBtn').textContent=ssPaused?'‚ñ∂ Lanjut':'‚è∏ Pause';
  if(ssPaused){clearTimeout(ssTimer);const f=document.getElementById('ssProgressFill');const w=parseFloat(f.style.width)||0;f.style.transition='none';f.style.width=w+'%';}
  else ssStartTimer();
}
function stopSlideshow(){clearTimeout(ssTimer);document.getElementById('slideshowOverlay').classList.remove('active');}

// ‚îÄ‚îÄ HELPER ‚îÄ‚îÄ
function fmtDate(d){if(!d)return'';try{return new Date(d).toLocaleDateString('id-ID',{day:'numeric',month:'short',year:'numeric'});}catch{return'';}}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
loadPhotos();
</script>
</body>
</html>
